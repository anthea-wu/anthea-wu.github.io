[{"content":"ä»€éº¼æ˜¯ Pre-commit Hook Git pre-commit hook æ˜¯ä¸€ç¨®æœ¬åœ°è…³æœ¬ï¼Œåœ¨è·‘ git commit å‘½ä»¤æ™‚æœƒè‡ªå‹•åŸ·è¡Œã€‚é€™äº› hook å¯ä»¥ç”¨ä¾†ç¢ºä¿ç¨‹å¼ç¢¼å“è³ªï¼Œä¾‹å¦‚ run testã€TypeScript å‹åˆ¥æª¢æŸ¥ã€åŸ·è¡Œ ES Lint ç­‰ç­‰ï¼Œç¢ºä¿åªæœ‰åˆæ ¼çš„ç¨‹å¼ç¢¼æ‰èƒ½è¢«æäº¤ã€‚\nLocal Hook çš„å¥½è™• åªå½±éŸ¿ localï¼Œä¸æœƒå¹²æ“¾å…¶ä»–åœ˜éšŠæˆå“¡ â†’ ä»¥æˆ‘å€‘åœ˜éšŠä¾†èªªï¼Œå› ç‚ºæ¯å€‹äººé›»è…¦è¦æ ¼ä¸åŒï¼Œå¦‚æœå¤§å®¶ commit å‰éƒ½éœ€è¦è·‘éä¸€æ¬¡æ¸¬è©¦å¯èƒ½æœƒå¾ˆæ²’æœ‰æ•ˆç‡ï¼Œæ‰€ä»¥æˆ‘é¸æ“‡åªå¯«åœ¨è‡ªå·±çš„ local ä¸Š ä¸éœ€è¦ä¿®æ”¹å°ˆæ¡ˆçš„ package.json ä¸æœƒè¢«æäº¤åˆ°ç‰ˆæœ¬åº« å¯ä»¥æ ¹æ“šå€‹äººéœ€æ±‚è‡ªå®šç¾©æª¢æŸ¥å…§å®¹ è¨­ç½®æ­¥é©Ÿ 1. å»ºç«‹ hooks ç›®éŒ„ 1 mkdir -p .git/hooks 2. å»ºç«‹ pre-commit æª”æ¡ˆ 1 touch .git/hooks/pre-commit 3. ç·¨å¯« pre-commit è…³æœ¬ å°‡ä»¥ä¸‹å…§å®¹å¯«å…¥ .git/hooks/pre-commit æª”æ¡ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 #!/bin/sh echo \u0026#34;Running pre-commit hook: tests and type checking...\u0026#34; # Exit on error set -e # Run tests echo \u0026#34;Running tests...\u0026#34; npm run test # Run type checking echo \u0026#34;Running type checking...\u0026#34; npm run tsc echo \u0026#34;All checks passed! Proceeding with commit.\u0026#34; 4. è¨­å®šåŸ·è¡Œæ¬Šé™ 1 chmod +x .git/hooks/pre-commit æ¸¬è©¦èˆ‡ä½¿ç”¨ å»ºç«‹ä¸€å€‹æ¸¬è©¦ commitï¼š\n1 2 git add . git commit -m \u0026#34;Test commit\u0026#34; å¦‚æœè¨­ç½®æ­£ç¢ºï¼ŒåŸ·è¡Œå¾Œå°±æœƒçœ‹åˆ°æ¸¬è©¦èˆ‡ TypeScript å‹åˆ¥æª¢æŸ¥å®Œå¾Œæ‰æœƒçœŸçš„ commit æˆåŠŸã€‚\nå¦‚æœéœ€è¦è‡¨æ™‚è·³é hook æª¢æŸ¥ï¼š\n1 git commit --no-verify Q\u0026amp;A å¦‚æœæˆ‘è¨­å®šäº†é€™å€‹ pre-commit çš„å…§å®¹ï¼Œæ˜¯ä¸æ˜¯é€£å¾Œç«¯å°ˆæ¡ˆçš„ commit éƒ½æœƒè·‘éé€™å€‹ pre-commitï¼Ÿ\npre-commit hook æ˜¯å„²å­˜åœ¨æ¯å€‹ Git å„²å­˜åº«çš„ .git/hooks ç›®éŒ„ä¸­ï¼Œåªå°è©²ç‰¹å®šå„²å­˜åº«æœ‰æ•ˆã€‚\næ‰€ä»¥èªªï¼Œæˆ‘å€‘åœ¨å“ªå€‹å°ˆæ¡ˆä¸­è¨­å®šçš„ pre-commit hookï¼š\nåªæœƒåœ¨å°é€™å€‹å°ˆæ¡ˆé€²è¡Œ commit æ™‚åŸ·è¡Œ ä¸æœƒå½±éŸ¿é›»è…¦ä¸Šçš„å…¶ä»–å°ˆæ¡ˆï¼ˆå¦‚å¾Œç«¯å°ˆæ¡ˆï¼‰ æ¯å€‹ Git å„²å­˜åº«éƒ½æœ‰è‡ªå·±ç¨ç«‹çš„ hooks è¨­å®š ","date":"2025-03-16T10:00:00+08:00","permalink":"https://anthea-wu.github.io/post/git-pre-commit-hook-local-setup/","title":"å¦‚ä½•åœ¨ local è¨­ç½® Git Pre-commit Hook"},{"content":"å‰è¨€ å‰›æ¥è§¸ JavaScript çš„æ™‚å€™ä¸çŸ¥é“å¤§å®¶æœ‰æ²’æœ‰çœ‹éé€™å€‹æƒ…å¢ƒï¼š\n1 2 3 4 5 6 7 console.log(\u0026#34;A\u0026#34;); setTimeout(() =\u0026gt; { console.log(\u0026#34;B\u0026#34;); }, 0); console.log(\u0026#34;C\u0026#34;); ä½ è¦ºå¾—è·‘å®Œä¸Šé¢çš„ç¨‹å¼ç¢¼å¾Œï¼Œæœ€å¾Œ log å°å‡ºä¾†çš„é †åºæ˜¯ä»€éº¼å‘¢ï¼Ÿ\nå¦‚æœä½ çš„ç­”æ¡ˆæ˜¯ A â†’ B â†’ C çš„è©±ï¼Œæ­¡è¿ä½ ä¾†åˆ°æˆ‘çš„æ–‡ç« ï¼å¸Œæœ›é€™ç¯‡æ–‡ç« å¯ä»¥å¹«åŠ©ä½ æ›´ç†è§£ JavaScript çš„ç¨‹å¼åŸ·è¡Œé †åºï¼Œç†è§£ç‚ºä»€éº¼é€™æ®µç¨‹å¼ç¢¼è·‘å®Œå¾Œï¼Œé †åºæœƒæ˜¯ A â†’ C â†’ Bã€‚\nåœ¨äº†è§£åŸ·è¡Œé †åºä¹‹å‰ï¼Œæˆ‘å€‘éœ€è¦å…ˆèªè­˜ JavaScript æ˜¯å¦‚ä½•è™•ç†ç¨‹å¼ç¢¼çš„ã€‚\nåŒæ­¥èˆ‡éåŒæ­¥çš„æ¦‚å¿µ åœ¨ JavaScript ä¸­ï¼Œç¨‹å¼ç¢¼çš„åŸ·è¡Œæ–¹å¼å¯ä»¥åˆ†ç‚ºåŒæ­¥ï¼ˆSynchronousï¼‰å’ŒéåŒæ­¥ï¼ˆAsynchronousï¼‰å…©ç¨®ï¼š\nåŒæ­¥ç¨‹å¼ç¢¼ï¼ˆSynchronousï¼‰ï¼šç¨‹å¼ç¢¼æœƒæŒ‰ç…§æ’°å¯«çš„é †åºé€è¡ŒåŸ·è¡Œï¼Œç•¶ä¸€å€‹å‡½å¼æ­£åœ¨åŸ·è¡Œæ™‚ï¼Œå…¶ä»–ç¨‹å¼ç¢¼å¿…é ˆç­‰å®ƒåŸ·è¡Œå®Œç•¢å¾Œæ‰èƒ½ç¹¼çºŒã€‚ éåŒæ­¥ç¨‹å¼ç¢¼ï¼ˆAsynchronousï¼‰ï¼šæŸäº›æ“ä½œå¯èƒ½æœƒèŠ±è²»è¼ƒé•·çš„æ™‚é–“ï¼ˆä¾‹å¦‚ I/O æ“ä½œã€ç¶²è·¯è«‹æ±‚ã€è¨ˆæ™‚å™¨ç­‰ï¼‰ï¼Œé€™äº›æ“ä½œä¸æœƒé˜»å¡ä¸»åŸ·è¡Œç·’ï¼Œè€Œæ˜¯æœƒåœ¨èƒŒæ™¯åŸ·è¡Œï¼Œç­‰åˆ°å®Œæˆå¾Œæ‰é€šçŸ¥ JavaScript åŸ·è¡Œå°æ‡‰çš„å›èª¿å‡½å¼ã€‚ æƒ³åƒä½ å»ä¸€å®¶æ—©é¤åº—é»é¤ åŒæ­¥å°±æ˜¯ä½ æ’éšŠé»äº†ä¸€ä»½ä¸‰æ˜æ²»ï¼Œç„¶å¾Œç«™åœ¨æ«ƒæª¯å‰ç­‰è€é—†åšå¥½æ‰é›¢é–‹ã€‚é€™æ™‚å€™è€é—†åªèƒ½è™•ç†ä½ çš„è¨‚å–®ï¼Œç„¡æ³•åŒæ™‚å¹«å…¶ä»–å®¢äººåšé¤é»ã€‚å¦‚æœé¤é»éœ€è¦ 5 åˆ†é˜ï¼Œæ‰€æœ‰å…¶ä»–å®¢äººéƒ½å¾—ç­‰ä½ å…ˆæ‹¿åˆ°æ‰è¼ªåˆ°ä»–å€‘ã€‚\nè€ŒéåŒæ­¥å‰‡æ˜¯ä½ å…ˆé»äº†ä¸‰æ˜æ²»ï¼Œè€é—†å‘Šè¨´ä½ ã€Œç­‰ä¸€ä¸‹ï¼Œæˆ‘åšå¥½æœƒå«ä½ ã€ï¼Œç„¶å¾Œç¹¼çºŒå¹«å…¶ä»–å®¢äººé»é¤ã€‚ç•¶ä½ çš„ä¸‰æ˜æ²»åšå¥½æ™‚ï¼Œè€é—†æ‰å–Šä½ çš„è™Ÿç¢¼ï¼Œä½ å†éå»æ‹¿é¤ã€‚é€™å€‹æƒ…å¢ƒä¸‹ï¼Œå…¶ä»–å®¢äººä¸éœ€è¦ç­‰ä½ æ‹¿åˆ°é¤é»ï¼Œå¤§å®¶çš„æœå‹™è®Šå¾—æ›´æœ‰æ•ˆç‡ã€‚\nåœ¨ JavaScript ä¸­ï¼š\nåŒæ­¥ç¨‹å¼ç¢¼ å°±åƒã€Œç«™åœ¨æ«ƒæª¯ç­‰è€é—†åšå¥½ä¸‰æ˜æ²»ã€ï¼Œæ‰€æœ‰ç¨‹å¼ç¢¼æœƒæŒ‰ç…§é †åºåŸ·è¡Œï¼Œç›´åˆ°ç•¶å‰çš„åŸ·è¡Œå®Œæˆï¼Œæ‰èƒ½ç¹¼çºŒä¸‹ä¸€æ­¥ã€‚ éåŒæ­¥ç¨‹å¼ç¢¼ å‰‡åƒã€Œé»å®Œé¤å¾Œå…ˆå»åšåˆ¥çš„äº‹ï¼Œç­‰ä¸‰æ˜æ²»åšå¥½äº†å†ä¾†æ‹¿ã€ï¼Œé€™æ¨£ JavaScript å¯ä»¥è™•ç†æ›´å¤šè«‹æ±‚ï¼Œè€Œä¸æœƒå› ç‚ºç­‰å¾…æŸå€‹çµæœè€Œå¡ä½ã€‚ Call Stackï¼ˆå‘¼å«å †ç–Šï¼‰ JavaScript æ¡ç”¨å–®ç·šç¨‹ï¼ˆsingle-threadedï¼‰æ¨¡å‹ï¼Œä»£è¡¨å®ƒä¸€æ¬¡åªèƒ½åŸ·è¡Œä¸€å€‹ä»»å‹™ã€‚å¦‚æœæœ‰å¤šå€‹ä»»å‹™è¦åŸ·è¡Œæ™‚ï¼Œé€™äº›ä»»å‹™å€‘å°±å¿…é ˆè¦æ’éšŠï¼Œç­‰å¾… JavaScript åŸ·è¡Œåˆ°ä»–å€‘ã€‚\né‚£é€™äº›ä»»å‹™æœƒåœ¨å“ªè£¡æ’éšŠå‘¢ï¼Ÿé€šå¸¸ä¾†èªªï¼ŒåŒæ­¥ç¨‹å¼ç¢¼éƒ½æœƒè¢«æ”¾åˆ°ä¸€å€‹å« Call Stackï¼ˆå‘¼å«å †ç–Šï¼‰çš„åœ°æ–¹ç­‰å¾…è¢«åŸ·è¡Œã€‚èˆ‰ä¸€å€‹ç°¡å–®çš„ä¾‹å­ä¾†èªªï¼š\n1 2 console.log(\u0026#34;A\u0026#34;); console.log(\u0026#34;B\u0026#34;); é€™æ™‚å€™ç¨‹å¼ç¢¼çš„é‹ä½œæœƒåƒæ˜¯é€™æ¨£ï¼š\nå¦‚æœç¨‹å¼ç¢¼éƒ½æ˜¯é€™æ¨£åŸ·è¡Œçš„è©±ï¼Œç‚ºä»€éº¼ä¸€é–‹å§‹çš„ä¾‹å­ï¼ŒsetTimeout è£¡çš„å…§å®¹æœƒæ˜¯æœ€å¾Œæ‰å‡ºç¾å‘¢ï¼Ÿ\nTask Queueï¼ˆä»»å‹™ä½‡åˆ—ï¼‰ é€™æ˜¯å› ç‚ºéåŒæ­¥çš„ç¨‹å¼ç¢¼æ’éšŠçš„åœ°æ–¹å’ŒåŒæ­¥çš„ç¨‹å¼ç¢¼ä¸åŒã€‚éåŒæ­¥çš„ç¨‹å¼ç¢¼é€šå¸¸æœƒæœ‰ä¸€å€‹ callback functionï¼Œè€Œä»–æœƒè¢«æ”¾åˆ° Task Queueï¼ˆä»»å‹™ä½‡åˆ—ï¼‰è£¡ç­‰å¾…ï¼Œç•¶ Call Stack æ²’æœ‰ä»»å‹™è¦åŸ·è¡Œæ™‚ï¼Œä»–æ‰æœƒè¢«å–å‡ºä¾†ï¼Œæ”¾åˆ° Call Stack è£¡è¢«åŸ·è¡Œã€‚èˆ‰ä¾‹ä¾†èªªï¼š\n1 2 3 4 5 6 7 8 9 10 11 console.log(\u0026#34;A\u0026#34;); setTimeout(() =\u0026gt; { console.log(\u0026#34;B\u0026#34;); }, 0); setTimeout(() =\u0026gt; { console.log(\u0026#34;C\u0026#34;); }, 0); console.log(\u0026#34;D\u0026#34;); åŸ·è¡Œé †åºæœƒæ˜¯ï¼š\né‚£èª°æœƒè² è²¬è™•ç† Call Stack è£¡é¢çš„ä»»å‹™ï¼Ÿåˆæ˜¯èª°è² è²¬æŠŠ Task Queue è£¡é¢çš„ä»»å‹™ç§»å‹•åˆ° Call Stack å…§è®“ä»–å€‘è¢«åŸ·è¡Œçš„ï¼Ÿ\nEvent Loopï¼ˆäº‹ä»¶è¿´åœˆï¼‰ Event Loopï¼ˆäº‹ä»¶è¿´åœˆï¼‰æ˜¯ JavaScript çš„æ ¸å¿ƒæ©Ÿåˆ¶ä¹‹ä¸€ï¼Œè² è²¬ç›£æ§ Call Stack å’Œ Task Queueï¼Œç¢ºä¿éåŒæ­¥ç¨‹å¼ç¢¼èƒ½å¤ æ­£ç¢ºåŸ·è¡Œã€‚\nè€Œ Event Loop æœƒå¹«å¿™åšé€™äº›äº‹æƒ…ï¼š\nå…ˆåŸ·è¡Œ Call Stack è£¡çš„æ‰€æœ‰åŒæ­¥ç¨‹å¼ç¢¼ å¦‚æœ Call Stack æ¸…ç©ºäº†ï¼ŒEvent Loop æœƒæª¢æŸ¥ Microtask Queueï¼ˆä¾‹å¦‚ Promise.then()ï¼‰ï¼Œå¦‚æœæœ‰ï¼Œå‰‡åŸ·è¡Œ ç•¶ Microtask Queue æ¸…ç©ºå¾Œï¼ŒEvent Loop æœƒæª¢æŸ¥ Task Queueï¼Œä¸¦å°‡ç¬¬ä¸€å€‹ç­‰å¾…çš„å›èª¿å‡½å¼æ¨å…¥ Call Stack åŸ·è¡Œ é‡è¤‡é€™å€‹éç¨‹ï¼Œç¢ºä¿æ‰€æœ‰ç¨‹å¼ç¢¼ä¾ç…§é©ç•¶çš„é †åºåŸ·è¡Œ æˆ‘å€‘åœ¨ä¸Šé¢æœ‰æåˆ° Call Stack å’Œ Task Queueï¼Œé‚£ Microtask Queue åˆæ˜¯ä»€éº¼ï¼Ÿ\nMicrotask Queueï¼ˆå¾®ä»»å‹™ä½‡åˆ—ï¼‰ é™¤äº† Task Queue ä¹‹å¤–ï¼Œé‚„æœ‰ä¸€å€‹å„ªå…ˆç´šåˆ¥æ›´é«˜çš„ä½‡åˆ—ï¼šMicrotask Queueï¼ˆå¾®ä»»å‹™ä½‡åˆ—ï¼‰ã€‚æœƒåœ¨é€™è£¡æ’éšŠçš„ä»»å‹™ä¹Ÿéƒ½æ˜¯éåŒæ­¥ç¨‹å¼ç¢¼ï¼Œåœ¨é€™ä¹‹ä¸­æœƒæœ‰æˆ‘å€‘å¾ˆå¸¸ä½¿ç”¨åˆ°çš„ä¸€å€‹äººï¼šPromise.then()ã€‚ä¸€æ¨£è®“æˆ‘å€‘ç”¨ä¸€å€‹ç°¡å–®çš„ä¾‹å­ä¾†çœ‹ä¸€ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 console.log(\u0026#34;A\u0026#34;); setTimeout(() =\u0026gt; { console.log(\u0026#34;B\u0026#34;); }, 0); Promise.resolve().then(() =\u0026gt; { console.log(\u0026#34;C\u0026#34;); }); console.log(\u0026#34;D\u0026#34;); ç¸½çµ è®“æˆ‘å€‘ä¾†å›é¡§ä¸€ä¸‹é€™ç¯‡æ–‡ç« æˆ‘å€‘å­¸åˆ°äº†ä»€éº¼ï¼š\nåŒæ­¥ç¨‹å¼ç¢¼ å°±åƒåœ¨éšŠä¼è£¡æ’éšŠçµå¸³ï¼Œä¸€è¡Œä¸€è¡Œåœ°åŸ·è¡Œï¼Œé€²å…¥ Call Stackï¼Œè·‘å®Œå¾Œæ‰æ›ä¸‹ä¸€å€‹ éåŒæ­¥ç¨‹å¼ç¢¼ï¼ˆåƒ setTimeoutï¼‰æœƒè¢«äº¤çµ¦ Web API è™•ç†ï¼Œç­‰å®ƒå€‘æº–å‚™å¥½ï¼Œæ‰æœƒè¢«æ”¾å›ä¾†ï¼Œæ’éšŠç­‰è‘—åŸ·è¡Œ Microtask Queueï¼ˆåƒ Promise.then()ï¼‰çš„å„ªå…ˆç´šæ¯” Task Queue é«˜ï¼Œæœƒå…ˆåŸ·è¡Œï¼Œæ‰€ä»¥ Promise.then() æœƒæ¯” setTimeout(..., 0) å…ˆè·‘ Event Loop å°±åƒ JavaScript çš„èª¿åº¦å“¡ï¼Œè² è²¬ç›£æ§ Call Stack å’Œ Task Queueï¼Œç¢ºä¿å¤§å®¶æŒ‰é †åºåŸ·è¡Œï¼Œä¸æœƒäº‚æ‰ é‚£éº¼ç¾åœ¨ï¼Œä½ å¯ä»¥ç†è§£ç‚ºä»€éº¼é€™æ®µç¨‹å¼ç¢¼è¢«å°å‡ºä¾†çš„é †åºæ˜¯ A â†’ C â†’ B äº†å—ï¼ŸğŸ˜‰\n1 2 3 4 5 6 7 console.log(\u0026#34;A\u0026#34;); setTimeout(() =\u0026gt; { console.log(\u0026#34;B\u0026#34;); }, 0); console.log(\u0026#34;C\u0026#34;); ","date":"2025-03-09T21:00:00+08:00","permalink":"https://anthea-wu.github.io/post/javascript-%E5%B7%A5%E7%A8%8B%E5%B8%AB%E7%9A%84%E4%BF%AE%E8%A1%8C%E4%B9%8B%E8%B7%AF1/","title":"JavaScript å·¥ç¨‹å¸«çš„ä¿®è¡Œä¹‹è·¯ï¼ˆ1ï¼‰"},{"content":"åœ¨ JavaScript çš„ä¸–ç•Œè£¡ï¼Œè™•ç†ç•°æ­¥æ“ä½œçš„æ–¹æ³•æœ‰å¤šç¨®ï¼Œå…¶ä¸­æœ€å¸¸è¢«è¨è«–çš„å°±æ˜¯ async/await èˆ‡ Promise.then()ã€‚é€™å…©è€…å„æœ‰ç‰¹è‰²èˆ‡é©ç”¨å ´æ™¯ï¼Œç†è§£å®ƒå€‘çš„å·®ç•°ï¼Œæœ‰åŠ©æ–¼æˆ‘å€‘åœ¨é–‹ç™¼ä¸­åšå‡ºæ›´æ˜æ™ºçš„é¸æ“‡ã€‚\næ¥ä¸‹ä¾†æˆ‘å°‡æœƒå¾èªæ³•é¢¨æ ¼ã€éŒ¯èª¤è™•ç†ã€åŸ·è¡Œé †åºé€™ä¸‰å€‹é¢å‘èªªæ˜ä¸€ä¸‹å…©è€…çš„å·®ç•°ã€‚\nèªæ³•é¢¨æ ¼èˆ‡å¯è®€æ€§ async/await çš„å‡ºç¾ï¼Œè®“æˆ‘å€‘å¯ä»¥ç”¨é¡ä¼¼åŒæ­¥çš„æ–¹å¼ä¾†æ’°å¯«ç•°æ­¥ç¨‹å¼ç¢¼ï¼Œæå‡äº†ç¨‹å¼çš„å¯è®€æ€§ã€‚ä¾‹å¦‚ï¼š\n1 2 3 4 5 6 7 8 9 async function fetchData() { try { const response = await fetch(\u0026#34;https://api.example.com/data\u0026#34;); const data = await response.json(); console.log(data); } catch (error) { console.error(\u0026#34;ç™¼ç”ŸéŒ¯èª¤ï¼š\u0026#34;, error); } } ç›¸æ¯”ä¹‹ä¸‹ï¼Œä½¿ç”¨ Promise.then() çš„å¯«æ³•å‰‡æ˜¯ï¼š\n1 2 3 4 5 6 7 8 9 10 function fetchData() { fetch(\u0026#34;https://api.example.com/data\u0026#34;) .then(response =\u0026gt; response.json()) .then(data =\u0026gt; { console.log(data); }) .catch(error =\u0026gt; { console.error(\u0026#34;ç™¼ç”ŸéŒ¯èª¤ï¼š\u0026#34;, error); }); } å¾ä¸Šè¿°ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œasync/await è®“ç¨‹å¼ç¢¼çµæ§‹æ›´æ¥è¿‘åŒæ­¥é‚è¼¯ï¼Œæ¸›å°‘äº†å·¢ç‹€çµæ§‹ï¼Œæå‡äº†å¯è®€æ€§ã€‚ç„¶è€Œï¼ŒPromise.then() åœ¨é async çš„ç’°å¢ƒä¸­ä»ç„¶é©ç”¨ï¼Œä¸”åœ¨æŸäº›æƒ…å¢ƒä¸‹å¯èƒ½æ›´ç‚ºç›´è§€ã€‚\nCallback Hell å•é¡Œ åœ¨ä½¿ç”¨ Promise.then() æ™‚ï¼Œå¦‚æœå¤šå€‹ç•°æ­¥æ“ä½œæœ‰ä¾è³´é—œä¿‚ï¼Œå¯èƒ½æœƒå°è‡´ Callback Hellï¼ˆå›èª¿åœ°ç„ï¼‰ã€‚ç•¶å›èª¿å‡½å¼éåº¦å·¢ç‹€æ™‚ï¼Œç¨‹å¼ç¢¼è®Šå¾—é›£ä»¥é–±è®€èˆ‡ç¶­è­·ã€‚ä¾‹å¦‚ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 function fetchUserData(userId) { fetch(`https://api.example.com/user/${userId}`) .then(response =\u0026gt; response.json()) .then(user =\u0026gt; { fetch(`https://api.example.com/orders/${user.id}`) .then(response =\u0026gt; response.json()) .then(orders =\u0026gt; { fetch(`https://api.example.com/order-details/${orders[0].id}`) .then(response =\u0026gt; response.json()) .then(orderDetails =\u0026gt; { console.log(\u0026#34;è¨‚å–®è©³ç´°è³‡æ–™:\u0026#34;, orderDetails); }) .catch(error =\u0026gt; console.error(\u0026#34;ç²å–è¨‚å–®è©³æƒ…å¤±æ•—:\u0026#34;, error)); }) .catch(error =\u0026gt; console.error(\u0026#34;ç²å–è¨‚å–®å¤±æ•—:\u0026#34;, error)); }) .catch(error =\u0026gt; console.error(\u0026#34;ç²å–ä½¿ç”¨è€…å¤±æ•—:\u0026#34;, error)); } é€™ç¨®åµŒå¥—çš„ .then() çµæ§‹æœƒå°è‡´ï¼š\né›£ä»¥é–±è®€èˆ‡ç¶­è­·ï¼šæ¯å€‹ç•°æ­¥æ“ä½œéƒ½å·¢ç‹€åœ¨å‰ä¸€å€‹ .then() å…§éƒ¨ï¼Œå¢åŠ äº†ç†è§£æˆæœ¬ã€‚ éŒ¯èª¤è™•ç†è¤‡é›œï¼šæ¯ä¸€å±¤ .then() éƒ½å¯èƒ½ç™¼ç”ŸéŒ¯èª¤ï¼Œè™•ç†èµ·ä¾†ç›¸ç•¶éº»ç…©ã€‚ å¦‚ä½•ç”¨ async/await è§£æ±º Callback Hellï¼Ÿ async/await å¯ä»¥è®“ç¨‹å¼ç¢¼è®Šå¾—æ›´ç›´è¦ºï¼Œé¿å…éåº¦å·¢ç‹€ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 async function fetchUserData(userId) { try { const userResponse = await fetch(`https://api.example.com/user/${userId}`); const user = await userResponse.json(); const ordersResponse = await fetch(`https://api.example.com/orders/${user.id}`); const orders = await ordersResponse.json(); const orderDetailsResponse = await fetch(`https://api.example.com/order-details/${orders[0].id}`); const orderDetails = await orderDetailsResponse.json(); console.log(\u0026#34;è¨‚å–®è©³ç´°è³‡æ–™:\u0026#34;, orderDetails); } catch (error) { console.error(\u0026#34;ç™¼ç”ŸéŒ¯èª¤ï¼š\u0026#34;, error); } } é€™æ¨£çš„å¯«æ³•è®“ç¨‹å¼ç¢¼çµæ§‹æ›´æ¸…æ™°ï¼Œä¸”å¯ä»¥é€é tryâ€¦catch çµ±ä¸€è™•ç†éŒ¯èª¤ï¼Œæ¸›å°‘ Callback Hell çš„å•é¡Œã€‚\néŒ¯èª¤è™•ç† åœ¨ä½¿ç”¨ async/await æ™‚ï¼Œæˆ‘å€‘é€šå¸¸é€é tryâ€¦catch ä¾†é€²è¡ŒéŒ¯èª¤è™•ç†ï¼Œé€™ä½¿å¾—éŒ¯èª¤è™•ç†é‚è¼¯æ›´ç‚ºé›†ä¸­ï¼š\n1 2 3 4 5 6 7 8 9 async function fetchData() { try { const response = await fetch(\u0026#34;https://api.example.com/data\u0026#34;); const data = await response.json(); console.log(data); } catch (error) { console.error(\u0026#34;ç™¼ç”ŸéŒ¯èª¤ï¼š\u0026#34;, error); } } è€Œä½¿ç”¨ Promise.then() æ™‚ï¼Œå‰‡æ˜¯é€é .catch() ä¾†æ•æ‰éŒ¯èª¤ï¼š\n1 2 3 4 5 6 7 8 9 10 function fetchData() { fetch(\u0026#34;https://api.example.com/data\u0026#34;) .then(response =\u0026gt; response.json()) .then(data =\u0026gt; { console.log(data); }) .catch(error =\u0026gt; { console.error(\u0026#34;ç™¼ç”ŸéŒ¯èª¤ï¼š\u0026#34;, error); }); } éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œawait æœƒç­‰å¾… Promise è§£æ±ºå¾Œå†ç¹¼çºŒåŸ·è¡Œï¼Œé€™æ„å‘³è‘—å®ƒæœƒæš«åœæ‰€åœ¨çš„ async å‡½å¼çš„åŸ·è¡Œï¼›è€Œ Promise.then() å‰‡æ˜¯åœ¨å°‡å›èª¿å‡½å¼åŠ å…¥å›èª¿éˆå¾Œï¼Œç¹¼çºŒåŸ·è¡Œç•¶å‰å‡½å¼ã€‚\nåŸ·è¡Œé †åº ä½¿ç”¨ await æ™‚ï¼Œéœ€è¦æ³¨æ„å¯èƒ½å°è‡´çš„é †åºåŸ·è¡Œå•é¡Œã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ç¨‹å¼ç¢¼æœƒä¾æ¬¡ç­‰å¾…æ¯å€‹ fetch å®Œæˆï¼Œå°è‡´ç¸½è€—æ™‚å¢åŠ ï¼š\n1 2 3 4 5 async function fetchData() { const data1 = await fetch(url1); const data2 = await fetch(url2); // è™•ç† data1 å’Œ data2 } ç‚ºäº†æé«˜æ•ˆç‡ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ Promise.all ä¾†ä¸¦è¡ŒåŸ·è¡Œå¤šå€‹ç•°æ­¥æ“ä½œï¼š\n1 2 3 4 async function fetchData() { const [data1, data2] = await Promise.all([fetch(url1), fetch(url2)]); // è™•ç† data1 å’Œ data2 } é€™æ¨£å¯ä»¥åŒæ™‚ç™¼é€å¤šå€‹è«‹æ±‚ï¼Œç¸®çŸ­ç¸½çš„åŸ·è¡Œæ™‚é–“ã€‚\nç¸½çµ ç‚ºäº†æ›´æ¸…æ¥šåœ°æ¯”è¼ƒ async/await èˆ‡ Promise çš„å·®ç•°ï¼Œæˆ‘å€‘å¯ä»¥ç”¨è¡¨æ ¼ä¾†æ•´ç†å®ƒå€‘çš„å„ªç¼ºé»ï¼š\nä»¥ä¸Šå°±æ˜¯ä»Šå¤©çš„åˆ†äº«ï¼Œæˆ‘å€‘ä¸‹ç¯‡æ–‡ç« è¦‹ ğŸ‘‹ğŸ»\n","date":"2025-03-09T15:30:00+08:00","permalink":"https://anthea-wu.github.io/post/javascript-journey-2/","title":"JavaScript å·¥ç¨‹å¸«çš„ä¿®è¡Œä¹‹è·¯ï¼ˆ2ï¼‰"},{"content":"SignalR Groups ç°¡ä»‹ å»¶çºŒä¸Šä¸€ç¯‡æ–‡ç« ä»‹ç´¹çš„ SignalR èŠå¤©å®¤æ¦‚å¿µï¼Œé€™æ¬¡è¦ä¾†èŠèŠã€Œå°æˆ¿é–“ã€åŠŸèƒ½ã€‚å¦‚æœä½ ç†Ÿæ‚‰ Discordï¼Œå¯ä»¥æŠŠ SignalR Groups æƒ³åƒæˆ Discord çš„èªéŸ³æˆ–æ–‡å­—é »é“ï¼Œæ¯å€‹é »é“å°±æ˜¯ä¸€å€‹ Groupï¼Œä½¿ç”¨è€…å¯ä»¥é€²å‡ºä¸åŒçš„é »é“ä¾†äº¤æµã€‚\nSignalR çš„ Groups è®“æˆ‘å€‘å¯ä»¥æŠŠé€£æ¥çš„ä½¿ç”¨è€…åˆ†æˆä¸åŒçš„ã€Œå°æˆ¿é–“ã€ï¼Œç”¨ä¾†å¯¦ç¾ç¾¤çµ„èŠå¤©ã€ç‰¹å®šç”¨æˆ¶å»£æ’­ç­‰åŠŸèƒ½ã€‚æ¯å€‹ä½¿ç”¨è€…å¯ä»¥åŒæ™‚åœ¨å¤šå€‹æˆ¿é–“è£¡ï¼Œé€™è®“è¨Šæ¯å‚³éè®Šå¾—å¾ˆå½ˆæ€§ã€‚\nGroups ä¸»è¦ç‰¹é» å‹•æ…‹ç®¡ç†ï¼šä½ å¯ä»¥éš¨æ™‚è®“ä½¿ç”¨è€…åŠ å…¥æˆ–é€€å‡ºæˆ¿é–“ï¼Œåƒæ˜¯éš¨æ™‚åŠ å…¥æˆ–é›¢é–‹ Discord é »é“ä¸€æ¨£ã€‚\nè‡¨æ™‚æ€§ï¼šæˆ¿é–“æˆå“¡è³‡æ–™åªå­˜åœ¨ä¼ºæœå™¨è¨˜æ†¶é«”è£¡ï¼Œä¼ºæœå™¨é‡å•Ÿå¾Œå°±æœƒæ¸…ç©ºï¼Œä¸ç”¨æ“”å¿ƒé•·æœŸç¶­è­·ã€‚\nå»£æ’­æ•ˆç‡ï¼šå¯ä»¥ä¸€æ¬¡æŠŠè¨Šæ¯ç™¼çµ¦æ•´å€‹æˆ¿é–“çš„äººï¼Œä¸éœ€è¦é‡è¤‡ç™¼é€ã€‚\nå¤šçµ„æˆå“¡ï¼šåŒä¸€å€‹ä½¿ç”¨è€…å¯ä»¥åŒæ™‚å¾…åœ¨å¾ˆå¤šæˆ¿é–“ï¼Œå°±åƒä½ å¯ä»¥åŠ å…¥å¥½å¹¾å€‹ Discord é »é“ä¸€æ¨£ã€‚\nå¯¦ä½œæ­¥é©Ÿ 1. æœå‹™å™¨ç«¯å¯¦ç¾ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 using Microsoft.AspNetCore.SignalR; namespace WebApiDemo.Hubs; public class ChatHub : Hub { // ä½¿ç”¨ Dictionary è¿½è¸ªç”¨æˆ¶æ‰€åœ¨çš„æˆ¿é–“ private static readonly Dictionary\u0026lt;string, string\u0026gt; UserRooms = new(); private static readonly string[] SensitiveWords = new[] { \u0026#34;è¨å­\u0026#34;, \u0026#34;ç¬¨è›‹\u0026#34;, \u0026#34;ç™½ç—´\u0026#34; }; // å‰ç½®éœ€æ±‚ï¼šè¨˜å¾—åœ¨ Program.cs ä¸­è¨­å®š SignalR æœå‹™ // builder.Services.AddSignalR(); // app.MapHub\u0026lt;ChatHub\u0026gt;(\u0026#34;/chatHub\u0026#34;); // åŠ å…¥æˆ¿é–“çš„æ–¹æ³• public async Task JoinRoom(string user, string roomName) { // æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦å·²åœ¨å…¶ä»–æˆ¿é–“ if (UserRooms.TryGetValue(Context.ConnectionId, out string? oldRoom)) { // å¾èˆŠæˆ¿é–“ç§»é™¤ await Groups.RemoveFromGroupAsync(Context.ConnectionId, oldRoom); // é€šçŸ¥èˆŠæˆ¿é–“çš„å…¶ä»–ç”¨æˆ¶ await Clients.Group(oldRoom).SendAsync(\u0026#34;ReceiveSystemMessage\u0026#34;, $\u0026#34;ç”¨æˆ¶ {user} é›¢é–‹äº†æˆ¿é–“\u0026#34;); } // å°‡ç”¨æˆ¶åŠ å…¥æ–°æˆ¿é–“ await Groups.AddToGroupAsync(Context.ConnectionId, roomName); // æ›´æ–°ç”¨æˆ¶æˆ¿é–“è¨˜éŒ„ UserRooms[Context.ConnectionId] = roomName; // é€šçŸ¥æ–°æˆ¿é–“çš„æ‰€æœ‰ç”¨æˆ¶ await Clients.Group(roomName).SendAsync(\u0026#34;ReceiveSystemMessage\u0026#34;, $\u0026#34;ç”¨æˆ¶ {user} åŠ å…¥äº†æˆ¿é–“\u0026#34;); } public async Task SendMessage(string user, string message) { if (ContainsSensitiveWords(message, out string foundWord)) { await Clients.Caller.SendAsync(\u0026#34;ReceiveSystemMessage\u0026#34;, $\u0026#34;æ¶ˆæ¯åŒ…å«æ•æ„Ÿè©ã€Œ{foundWord}ã€ï¼Œå·²è¢«æ””æˆª\u0026#34;); return; } // æª¢æŸ¥ç”¨æˆ¶æ‰€åœ¨çš„æˆ¿é–“ if (UserRooms.TryGetValue(Context.ConnectionId, out string? room)) { // åªå‘åŒä¸€æˆ¿é–“çš„ç”¨æˆ¶ç™¼é€æ¶ˆæ¯ await Clients.Group(room).SendAsync(\u0026#34;ReceiveMessage\u0026#34;, user, message); } } private bool ContainsSensitiveWords(string message, out string foundWord) { foundWord = SensitiveWords.FirstOrDefault(word =\u0026gt; message.Contains(word, StringComparison.OrdinalIgnoreCase)); return foundWord != null; } // ç•¶æ–°å®¢æˆ¶ç«¯é€£æ¥æ™‚è§¸ç™¼ public override async Task OnConnectedAsync() { // Context.ConnectionId: æ¯å€‹é€£æ¥çš„å”¯ä¸€æ¨™è­˜ await Clients.All.SendAsync(\u0026#34;UserConnected\u0026#34;, Context.ConnectionId); await base.OnConnectedAsync(); } // ç•¶å®¢æˆ¶ç«¯æ–·é–‹é€£æ¥æ™‚è§¸ç™¼ public override async Task OnDisconnectedAsync(Exception? exception) { // ç”¨æˆ¶æ–·é–‹é€£æ¥æ™‚æ¸…ç†æˆ¿é–“è³‡è¨Š if (UserRooms.TryGetValue(Context.ConnectionId, out string? room)) { await Groups.RemoveFromGroupAsync(Context.ConnectionId, room); UserRooms.Remove(Context.ConnectionId); } await Clients.All.SendAsync(\u0026#34;UserDisconnected\u0026#34;, Context.ConnectionId); await base.OnDisconnectedAsync(exception); } } Groups ç›¸é—œçš„é‡è¦æ–¹æ³• Groups.AddToGroupAsyncï¼šå°‡ä½¿ç”¨è€…åŠ å…¥æˆ¿é–“ Groups.RemoveFromGroupAsyncï¼šå°‡ä½¿ç”¨è€…å¾æˆ¿é–“ä¸­ç§»é™¤ Clients.Groupï¼šå‘æŒ‡å®šæˆ¿é–“çš„ä½¿ç”¨è€…ç™¼é€æ¶ˆæ¯ 2. å®¢æˆ¶ç«¯å¯¦ç¾ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;SignalR èŠå¤©å®¤\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; #messagesList { border: 1px solid #ccc; height: 300px; overflow-y: auto; padding: 10px; margin-bottom: 10px; } .form-group { margin: 10px 0; } .form-group label { display: inline-block; width: 70px; } .form-group input { padding: 5px; width: 200px; } #sendButton { padding: 5px 15px; margin-top: 10px; } .system-message { color: #ff4444; font-style: italic; margin: 5px 0; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;SignalR èŠå¤©å®¤\u0026lt;/h2\u0026gt; \u0026lt;!-- æ·»åŠ æˆ¿é–“é¸æ“‡ --\u0026gt; \u0026lt;div class=\u0026#34;form-group\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;roomInput\u0026#34;\u0026gt;æˆ¿é–“:\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; id=\u0026#34;roomInput\u0026#34; /\u0026gt; \u0026lt;button id=\u0026#34;joinButton\u0026#34;\u0026gt;åŠ å…¥æˆ¿é–“\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div id=\u0026#34;messagesList\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;form-group\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;userInput\u0026#34;\u0026gt;ç”¨æˆ¶å:\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; id=\u0026#34;userInput\u0026#34; /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;form-group\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;messageInput\u0026#34;\u0026gt;æ¶ˆæ¯:\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; id=\u0026#34;messageInput\u0026#34; /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;button id=\u0026#34;sendButton\u0026#34;\u0026gt;ç™¼é€\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; // å»ºç«‹é€£æ¥ const connection = new signalR.HubConnectionBuilder() .withUrl(\u0026#34;/chatHub\u0026#34;) // Hub çš„è·¯ç”± .build(); document.getElementById(\u0026#34;sendButton\u0026#34;).disabled = true; // è¨»å†Šæ¥æ”¶æ¶ˆæ¯çš„è™•ç†å‡½æ•¸ connection.on(\u0026#34;ReceiveMessage\u0026#34;, function (user, message) { const msg = `${user}: ${message}`; const li = document.createElement(\u0026#34;div\u0026#34;); li.textContent = msg; document.getElementById(\u0026#34;messagesList\u0026#34;).appendChild(li); }); // è™•ç†ç”¨æˆ¶é€£æ¥äº‹ä»¶ connection.on(\u0026#34;UserConnected\u0026#34;, function (connectionId) { const msg = `ç”¨æˆ¶å·²é€£æ¥ (${connectionId})`; const li = document.createElement(\u0026#34;div\u0026#34;); li.textContent = msg; li.style.color = \u0026#34;green\u0026#34;; document.getElementById(\u0026#34;messagesList\u0026#34;).appendChild(li); }); connection.on(\u0026#34;UserDisconnected\u0026#34;, function (connectionId) { const msg = `ç”¨æˆ¶å·²æ–·é–‹é€£æ¥ (${connectionId})`; const li = document.createElement(\u0026#34;div\u0026#34;); li.textContent = msg; li.style.color = \u0026#34;red\u0026#34;; document.getElementById(\u0026#34;messagesList\u0026#34;).appendChild(li); }); connection.on(\u0026#34;ReceiveSystemMessage\u0026#34;, function (message) { const div = document.createElement(\u0026#34;div\u0026#34;); div.textContent = `ç³»çµ±æç¤º: ${message}`; div.className = \u0026#34;system-message\u0026#34;; document.getElementById(\u0026#34;messagesList\u0026#34;).appendChild(div); }); // å•Ÿå‹•é€£æ¥ connection.start().then(function () { document.getElementById(\u0026#34;sendButton\u0026#34;).disabled = false; }).catch(function (err) { return console.error(err.toString()); }); // ç™¼é€æ¶ˆæ¯ document.getElementById(\u0026#34;sendButton\u0026#34;).addEventListener(\u0026#34;click\u0026#34;, function (event) { const user = document.getElementById(\u0026#34;userInput\u0026#34;).value; const message = document.getElementById(\u0026#34;messageInput\u0026#34;).value; // èª¿ç”¨æœå‹™å™¨ç«¯çš„ SendMessage æ–¹æ³• connection.invoke(\u0026#34;SendMessage\u0026#34;, user, message).catch(function (err) { return console.error(err.toString()); }); document.getElementById(\u0026#34;messageInput\u0026#34;).value = \u0026#34;\u0026#34;; event.preventDefault(); }); // æ·»åŠ åŠ å…¥æˆ¿é–“æŒ‰éˆ•çš„è™•ç† document.getElementById(\u0026#34;joinButton\u0026#34;).addEventListener(\u0026#34;click\u0026#34;, function (event) { const user = document.getElementById(\u0026#34;userInput\u0026#34;).value; const room = document.getElementById(\u0026#34;roomInput\u0026#34;).value; if (!user || !room) { alert(\u0026#34;è«‹è¼¸å…¥ç”¨æˆ¶åå’Œæˆ¿é–“å\u0026#34;); return; } connection.invoke(\u0026#34;JoinRoom\u0026#34;, user, room); event.preventDefault(); }); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; æ¸¬è©¦æ•ˆæœ é€™æ™‚å€™é‹è¡Œä½ çš„å°ˆæ¡ˆï¼ˆä½ æ‡‰è©²æœ‰è¨˜å¾—åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä¸€èµ·è¨­å®šé launchSettings.json å°å§ï¼‰ï¼Œè¼¸å…¥ localhost:5000/index.htmlï¼Œå°±å¯ä»¥çœ‹åˆ°ä»¥ä¸‹çš„ç•«é¢ï¼š\nä¸€é€²å…¥çš„æ™‚å€™æ²’æœ‰ç‰¹åˆ¥æŒ‡å®šæˆ¿é–“ï¼Œå¦‚æœ Anthea é€²å…¥åˆ°æˆ¿é–“ï¼ˆæ˜æ˜Ÿä¸‰ç¼ºä¸€ï¼‰ï¼Œé€™æ™‚å€™ä»–çš„è¨Šæ¯åªæœƒç™¼çµ¦åŒä¸€å€‹æˆ¿é–“è£¡çš„äººï¼Œæ²’æœ‰é€²å…¥åŒä¸€å€‹æˆ¿é–“çš„ Ensui å°±æ”¶ä¸åˆ°è¨Šæ¯äº†ã€‚\n","date":"2025-01-07T21:00:00+08:00","permalink":"https://anthea-wu.github.io/post/%E8%81%8A%E5%A4%A9%E5%AE%A4%E7%9A%84%E5%B0%8F%E6%88%BF%E9%96%93/","title":".NET SignalR çš„å­¸ç¿’èˆ‡æ‡‰ç”¨ï¼ˆ2ï¼‰"},{"content":"SignalR ç°¡ä»‹ å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡æ¥è§¸ SignalRï¼Œå¯ä»¥æƒ³åƒå®ƒæ˜¯ä¸€å€‹å¹«ä½ è™•ç†å³æ™‚é€šè¨Šçš„å·¥å…·ã€‚å®ƒæœƒè‡ªå‹•å¹«ä½ æå®šèª°åœ¨ç·šä¸Šã€èª°ä¸‹ç·šäº†ï¼Œé‚„èƒ½è®“ä½ è¼•é¬†æŠŠè¨Šæ¯é€çµ¦æ‰€æœ‰äººæˆ–æŒ‡å®šçš„äººï¼Œè€Œä¸”å¯ä»¥æ‡‰ä»˜å¾ˆå¤šäººåŒæ™‚ä½¿ç”¨ã€‚ç°¡å–®ä¾†èªªï¼Œä¸ç”¨ç…©æƒ±é‚£äº›è¤‡é›œçš„åº•å±¤ç´°ç¯€ï¼ŒSignalR å¹«ä½ åŒ…å¥½äº†ï¼\nå‚³è¼¸å”è­° ä½ å¯èƒ½æœƒæƒ³å•ï¼ŒSignalR åˆ°åº•æ€éº¼åšåˆ°è®“è¨Šæ¯é€™éº¼å³æ™‚çš„å‘¢ï¼Ÿå…¶å¯¦å®ƒæœƒè‡ªå‹•å¹«ä½ é¸æ“‡æœ€é©åˆçš„å‚³è¼¸æ–¹å¼ï¼š\nWebSocketï¼šå°±åƒä¸€ç›´é–‹è‘—çš„å°ˆç·šï¼Œé€Ÿåº¦æœ€å¿«ï¼Œä¹Ÿæ˜¯é¦–é¸ã€‚ Server-Sent Events (SSE)ï¼šä¼ºæœå™¨ä¸»å‹•æ¨æ¶ˆæ¯çµ¦ä½ ï¼Œåƒè¨‚é–±æ–°èä¸€æ¨£ã€‚ Long Pollingï¼šä¸æ–·å•ä¼ºæœå™¨ã€Œæœ‰æ–°æ¶ˆæ¯å—ï¼Ÿã€ä¾†é”æˆå³æ™‚æ•ˆæœã€‚ ä¸ç”¨æ“”å¿ƒæ€éº¼æŒ‘ï¼ŒSignalR æœƒå¹«ä½ æå®šï¼\nå¯¦ä½œæ­¥é©Ÿ 1. å»ºç«‹å°ˆæ¡ˆä¸¦æ·»åŠ  SignalR åœ¨ .NET Core/.NET 5+ ä¸­ï¼ŒSignalR å·²ç¶“è¢«æ•´åˆåˆ° ASP.NET Core æ¡†æ¶ä¸­äº†ï¼Œæ‰€ä»¥æˆ‘å€‘ä¸éœ€è¦é¡å¤–å®‰è£ SignalR çš„æœå‹™å™¨ç«¯å¥—ä»¶ï¼Œåªéœ€è¦åœ¨ Program.cs ä¸­é…ç½® SignalRï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 using WebApiDemo.Hubs; var builder = WebApplication.CreateBuilder(args); // æ·»åŠ  SignalR æœå‹™åˆ° DI å®¹å™¨ builder.Services.AddSignalR(); var app = builder.Build(); app.UseStaticFiles(); app.UseRouting(); // å•Ÿç”¨è·¯ç”± // é…ç½® SignalR Hub è·¯ç”± app.MapHub\u0026lt;ChatHub\u0026gt;(\u0026#34;/chatHub\u0026#34;); // è¨­ç½®é»˜èªé é¢ app.MapGet(\u0026#34;/\u0026#34;, () =\u0026gt; Results.File(\u0026#34;wwwroot/index.html\u0026#34;, \u0026#34;text/html\u0026#34;)); app.Run(); 2. å‰µå»º Hub Hub æ˜¯ SignalR çš„æ ¸å¿ƒè§’è‰²ï¼Œå¯ä»¥æƒ³æˆã€Œè¨Šæ¯å°å¹«æ‰‹ã€ï¼Œè² è²¬åœ¨ç”¨æˆ¶çš„ç€è¦½å™¨å’Œä¼ºæœå™¨ä¹‹é–“å‚³éè¨Šæ¯ã€‚åŸºæœ¬çš„ Hub éœ€è¦åšçš„äº‹å¾ˆç°¡å–®ï¼šæ”¶åˆ°ä½¿ç”¨è€…çš„è¨Šæ¯ä¸¦è½‰é€çµ¦å…¶ä»–äººï¼Œè™•ç†ä½¿ç”¨è€…é€£ç·šå’Œæ–·ç·šçš„é€šçŸ¥ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 using Microsoft.AspNetCore.SignalR; namespace WebApiDemo.Hubs; public class ChatHub : Hub { // é€™å€‹æ–¹æ³•ç”¨ä¾†æ¥æ”¶ä½¿ç”¨è€…çš„è¨Šæ¯ä¸¦å»£æ’­çµ¦æ‰€æœ‰äºº public async Task SendMessage(string user, string message) { await Clients.All.SendAsync(\u0026#34;ReceiveMessage\u0026#34;, user, message); } // ä½¿ç”¨è€…é€£ç·šæ™‚æœƒè§¸ç™¼é€™è£¡ï¼ŒæŠŠæ–°åŠ å…¥çš„ä½¿ç”¨è€…é€šçŸ¥çµ¦å¤§å®¶ public override async Task OnConnectedAsync() { await Clients.All.SendAsync(\u0026#34;UserConnected\u0026#34;, Context.ConnectionId); await base.OnConnectedAsync(); } // ä½¿ç”¨è€…æ–·ç·šæ™‚æœƒåŸ·è¡Œé€™è£¡ï¼ŒæŠŠèª°é›¢é–‹çš„é€šçŸ¥ç™¼çµ¦æ‰€æœ‰äºº public override async Task OnDisconnectedAsync(Exception? exception) { await Clients.All.SendAsync(\u0026#34;UserDisconnected\u0026#34;, Context.ConnectionId); await base.OnDisconnectedAsync(exception); } } Hub é‡è¦å±¬æ€§ Clientsï¼šè² è²¬æŠŠè¨Šæ¯ç™¼é€çµ¦èª°ï¼Œä¾‹å¦‚ï¼š\nClients.Allï¼šé€çµ¦æ‰€æœ‰äººï¼Œä¸ç®¡æ˜¯èª° Clients.Callerï¼šåªå›å‚³çµ¦ç™¼é€è¨Šæ¯çš„äºº Clients.Othersï¼šé€çµ¦é™¤äº†ç™¼è¨Šæ¯çš„äººä»¥å¤–çš„æ‰€æœ‰äºº Contextï¼šæä¾›é—œæ–¼é€™æ¬¡é€£ç·šçš„è³‡è¨Šï¼Œä¾‹å¦‚ï¼š\nContext.ConnectionIdï¼šæ¯å€‹ä½¿ç”¨è€…é€£ä¸Šä¾†å¾Œéƒ½æœ‰ä¸€å€‹ç¨ä¸€ç„¡äºŒçš„ç·¨è™Ÿ Context.Userï¼šä½¿ç”¨è€…çš„èº«ä»½è³‡è¨Šï¼Œé©ç”¨åœ¨éœ€è¦ç™»å…¥æˆ–èªè­‰çš„æ‡‰ç”¨ç¨‹å¼ 3. å®¢æˆ¶ç«¯å¯¦ç¾ åœ¨ root ç›®éŒ„åº•ä¸‹å»ºç«‹ wwwroot çš„è³‡æ–™å¤¾ï¼Œä¸¦ä¸”å»ºç«‹ index.html è¼¸å…¥ä»¥ä¸‹å…§å®¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;SignalR èŠå¤©å®¤\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; #messagesList { border: 1px solid #ccc; height: 300px; overflow-y: auto; padding: 10px; margin-bottom: 10px; } .form-group { margin: 10px 0; } .form-group label { display: inline-block; width: 70px; } .form-group input { padding: 5px; width: 200px; } #sendButton { padding: 5px 15px; margin-top: 10px; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;SignalR èŠå¤©å®¤\u0026lt;/h2\u0026gt; \u0026lt;div id=\u0026#34;messagesList\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;form-group\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;userInput\u0026#34;\u0026gt;ç”¨æˆ¶å:\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; id=\u0026#34;userInput\u0026#34; /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;form-group\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;messageInput\u0026#34;\u0026gt;æ¶ˆæ¯:\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; id=\u0026#34;messageInput\u0026#34; /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;button id=\u0026#34;sendButton\u0026#34;\u0026gt;ç™¼é€\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; // å»ºç«‹é€£æ¥ const connection = new signalR.HubConnectionBuilder() .withUrl(\u0026#34;/chatHub\u0026#34;) // Hub çš„è·¯ç”± .build(); document.getElementById(\u0026#34;sendButton\u0026#34;).disabled = true; // è¨»å†Šæ¥æ”¶æ¶ˆæ¯çš„è™•ç†å‡½æ•¸ connection.on(\u0026#34;ReceiveMessage\u0026#34;, function (user, message) { const msg = `${user}: ${message}`; const li = document.createElement(\u0026#34;div\u0026#34;); li.textContent = msg; document.getElementById(\u0026#34;messagesList\u0026#34;).appendChild(li); }); // è™•ç†ç”¨æˆ¶é€£æ¥äº‹ä»¶ connection.on(\u0026#34;UserConnected\u0026#34;, function (connectionId) { const msg = `ç”¨æˆ¶å·²é€£æ¥ (${connectionId})`; const li = document.createElement(\u0026#34;div\u0026#34;); li.textContent = msg; li.style.color = \u0026#34;green\u0026#34;; document.getElementById(\u0026#34;messagesList\u0026#34;).appendChild(li); }); connection.on(\u0026#34;UserDisconnected\u0026#34;, function (connectionId) { const msg = `ç”¨æˆ¶å·²æ–·é–‹é€£æ¥ (${connectionId})`; const li = document.createElement(\u0026#34;div\u0026#34;); li.textContent = msg; li.style.color = \u0026#34;red\u0026#34;; document.getElementById(\u0026#34;messagesList\u0026#34;).appendChild(li); }); // å•Ÿå‹•é€£æ¥ connection.start().then(function () { document.getElementById(\u0026#34;sendButton\u0026#34;).disabled = false; }).catch(function (err) { return console.error(err.toString()); }); // ç™¼é€æ¶ˆæ¯ document.getElementById(\u0026#34;sendButton\u0026#34;).addEventListener(\u0026#34;click\u0026#34;, function (event) { const user = document.getElementById(\u0026#34;userInput\u0026#34;).value; const message = document.getElementById(\u0026#34;messageInput\u0026#34;).value; // èª¿ç”¨æœå‹™å™¨ç«¯çš„ SendMessage æ–¹æ³• connection.invoke(\u0026#34;SendMessage\u0026#34;, user, message).catch(function (err) { return console.error(err.toString()); }); document.getElementById(\u0026#34;messageInput\u0026#34;).value = \u0026#34;\u0026#34;; event.preventDefault(); }); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; é€™æ™‚å€™é‹è¡Œä½ çš„å°ˆæ¡ˆï¼ˆè¨˜å¾—è¨­å®š launchSettings.jsonï¼‰ï¼Œè¼¸å…¥ localhost:5000/index.htmlï¼Œå°±å¯ä»¥çœ‹åˆ°ä»¥ä¸‹çš„ç•«é¢ã€‚\nå¦‚æœä½ å†å¤šé–‹ä¸€å€‹æ–°çš„ tabï¼Œå°±æœƒçœ‹åˆ°ç¬¬ä¸€å€‹ tab å¤šäº†ä¸€è¡Œé€£æ¥çš„ç”¨æˆ¶ï¼š\nå…©å€‹ä¸åŒçš„äººå¯ä»¥è¼¸å…¥è¨Šæ¯ï¼ŒæŒ‰ä¸‹ç™¼é€å¾Œï¼Œå¦å¤–ä¸€é‚Šä¹Ÿæœƒæ”¶åˆ°ï¼š\næœ‰äººé›¢é–‹çš„è©±å°±å¯ä»¥é€å‡ºé€šçŸ¥ï¼š\n","date":"2025-01-04T21:00:00+08:00","permalink":"https://anthea-wu.github.io/post/%E7%B0%A1%E5%96%AE%E7%B6%B2%E9%A0%81%E8%81%8A%E5%A4%A9%E5%AE%A4/","title":".NET SignalR çš„å­¸ç¿’èˆ‡æ‡‰ç”¨ï¼ˆ1ï¼‰"},{"content":"ä¸Šä¸€ç¯‡æåˆ°åŸºæœ¬çš„ä¸‹æ‹‰å¼é¸å–®æ‡‰ç”¨ä¹‹å¾Œï¼Œæ¥ä¸‹ä¾†è¦è¨˜éŒ„çš„æ˜¯å¤šå€‹é¸å–®å½¼æ­¤é€£å‹•æ™‚çš„æ‡‰ç”¨ã€‚\nä»¥å‰ä¸€ç¯‡å·¥ä½œä¸Šçš„ä¾‹å­ä¾†èªªï¼Œé€šå¸¸æŠŠè³‡æ–™ç”¨ç¸£å¸‚ã€é„‰é®å¸‚å€ã€åœ°æ®µé€™ä¸‰ç¨®å±¤ç´šå€åˆ†é–‹ä¾†ï¼Œæ‰€ä»¥ç•¶æˆ‘é¸åˆ°å°åŒ—å¸‚çš„æ™‚å€™ï¼Œé„‰é®å¸‚å€çš„é¸å–®è£¡å°±ä¸æ‡‰è©²æœƒå‡ºç¾è¥¿å±¯å€çš„é …ç›®ï¼Œé€™å€‹å°±æ˜¯æˆ‘æ‰€è¬‚çš„é€£å‹• â€” â€” ç•¶å…¶ä¸­ä¸€å€‹é¸é …çš„å€¼æ”¹è®Šï¼Œå°±æœƒè®“å…¶ä»–çš„é¸å–®å…§å®¹ä¹Ÿè·Ÿè‘—ä¸åŒã€‚\näº‹å‰æº–å‚™ ç°¡å–®çš„ API æ¸…å–®ä¾†æºä¸€æ¨£æ˜¯åœ°ç±åœ–è³‡ç¶²è·¯ä¾¿æ°‘æœå‹™ç³»çµ±ï¼Œæˆ‘åªæ•´ç†äº†å°ä¸­å¸‚çš„è¥¿å±¯å€å’Œè¥¿å€é€™å…©å€‹è¡Œæ”¿å€åº•ä¸‹çš„æ®µåä½œç‚ºç¯„ä¾‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 using Microsoft.AspNetCore.Mvc; using Newtonsoft.Json; namespace bootstrap_selected_sample.Controllers; [ApiController] [Route(\u0026#34;api/[controller]\u0026#34;)] public class CodeController : ControllerBase { [HttpGet] public IActionResult Counties() { var path = \u0026#34;files/county.json\u0026#34;; var json = ReadFromJson(path); var info = JsonConvert.DeserializeObject\u0026lt;List\u0026lt;SimpleInfo\u0026gt;\u0026gt;(json); return Ok(info); } [HttpGet(\u0026#34;{county}\u0026#34;)] public IActionResult Towns(string county) { var path = county.ToUpper() switch { \u0026#34;B\u0026#34; =\u0026gt; \u0026#34;files/taichung.json\u0026#34; }; var json = ReadFromJson(path); var info = JsonConvert.DeserializeObject\u0026lt;List\u0026lt;SimpleInfo\u0026gt;\u0026gt;(json); return Ok(info); } [HttpGet(\u0026#34;{county}/{town}\u0026#34;)] public IActionResult Sections(string county, string town) { var path = \u0026#34;\u0026#34;; switch (county) { case \u0026#34;B\u0026#34; when town == \u0026#34;06\u0026#34;: path = \u0026#34;files/xitun.json\u0026#34;; break; case \u0026#34;B\u0026#34; when town == \u0026#34;04\u0026#34;: path = \u0026#34;files/xi.json\u0026#34;; break; } var json = ReadFromJson(path); var info = JsonConvert.DeserializeObject\u0026lt;List\u0026lt;ComplexInfo\u0026gt;\u0026gt;(json); return Ok(info); } private string ReadFromJson(string path) { var reader = new StreamReader(path); var readToEnd = reader.ReadToEnd().Replace(\u0026#34;\\r\u0026#34;, \u0026#34;\u0026#34;).Replace(\u0026#34;\\n\u0026#34;, \u0026#34;\u0026#34;).Replace(\u0026#34; \u0026#34;, \u0026#34;\u0026#34;); return readToEnd; } } public class SimpleInfo { public string Id { get; set; } public string Name { get; set; } } public class ComplexInfo : SimpleInfo { public string OfficeCode { get; set; } } å¥—ç”¨ bootstrap-select é¦–å…ˆï¼Œæˆ‘å€‘ä¾ç…§ä¸Šæ¬¡çš„æ–¹æ³•ï¼Œä½¿ç”¨ Vue.$nextTick() ä¾†è©¦è©¦çœ‹æ•ˆæœæ€éº¼æ¨£ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 \u0026lt;!-- sample.html --\u0026gt; \u0026lt;div id=\u0026#34;app\u0026#34; class=\u0026#34;container my-5\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;row\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;col-12 mt-5 row\u0026#34;\u0026gt; \u0026lt;form\u0026gt; \u0026lt;div class=\u0026#34;row g-3 align-items-center\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;col-auto\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;county-select\u0026#34; class=\u0026#34;col-form-label\u0026#34;\u0026gt;ç¸£å¸‚\u0026lt;/label\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;col-auto\u0026#34;\u0026gt; \u0026lt;select id=\u0026#34;county-select\u0026#34; v-model=\u0026#34;selected.county\u0026#34;\u0026gt; \u0026lt;option v-for=\u0026#34;c in code.county\u0026#34; :value=\u0026#34;c\u0026#34;\u0026gt;{{c.name}}\u0026lt;/option\u0026gt; \u0026lt;/select\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;col-auto\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;county-select\u0026#34; class=\u0026#34;col-form-label\u0026#34;\u0026gt;é„‰é®å¸‚å€\u0026lt;/label\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;col-auto\u0026#34;\u0026gt; \u0026lt;select id=\u0026#34;town-select\u0026#34; v-model=\u0026#34;selected.town\u0026#34;\u0026gt; \u0026lt;option v-for=\u0026#34;t in code.town\u0026#34; :value=\u0026#34;t\u0026#34;\u0026gt;{{t.name}}\u0026lt;/option\u0026gt; \u0026lt;/select\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;col-auto\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;county-select\u0026#34; class=\u0026#34;col-form-label\u0026#34;\u0026gt;åœ°æ®µ\u0026lt;/label\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;col-auto\u0026#34;\u0026gt; \u0026lt;select id=\u0026#34;section-select\u0026#34; v-model=\u0026#34;selected.section\u0026#34;\u0026gt; \u0026lt;option v-for=\u0026#34;s in code.section\u0026#34; :value=\u0026#34;s\u0026#34;\u0026gt;{{s.name}}\u0026lt;/option\u0026gt; \u0026lt;/select\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;col-12 mt-3 row\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;col-4\u0026#34; v-if=\u0026#34;selected.county !== null \u0026amp;\u0026amp; selected.town !== null \u0026amp;\u0026amp; selected.section !== null\u0026#34;\u0026gt; å·²ç¶“é¸æ“‡ï¼š{{selected.county.name}} {{selected.town.name}} {{selected.section.name}} \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 // sample.js const app = Vue.createApp({ data(){ return{ code:{ county: [], town: [], section: [] }, selected:{ county: null, town: null, section: null } } }, methods:{ getCounties(){ this.selected.county = null; this.selected.town = null; this.selected.section = null; axios({ method: \u0026#39;get\u0026#39;, url: \u0026#39;./api/code\u0026#39; }).then(res =\u0026gt; { this.code.county = res.data; Vue.nextTick(() =\u0026gt; { $(\u0026#39;#county-select\u0026#39;).selectpicker(); }) }) }, getTowns(){ this.selected.town = null; this.selected.section = null; axios({ method: \u0026#39;get\u0026#39;, url: `./api/code/${this.selected.county.id}` }).then(res =\u0026gt; { this.code.town = res.data; Vue.nextTick(() =\u0026gt; { $(\u0026#39;#town-select\u0026#39;).selectpicker(); }) }) }, getSections(){ this.selected.section = null; axios({ method: \u0026#39;get\u0026#39;, url: `./api/code/${this.selected.county.id}/${this.selected.town.id}` }).then(res =\u0026gt; { this.code.section = res.data; Vue.nextTick(() =\u0026gt; { $(\u0026#39;#section-select\u0026#39;).selectpicker(); }) }) }, }, watch:{ \u0026#39;selected.county\u0026#39;: function (newVal) { if (newVal === \u0026#39;\u0026#39; || newVal === null) return; this.getTowns(); }, \u0026#39;selected.town\u0026#39;: function (newVal) { if (newVal === \u0026#39;\u0026#39; || newVal === null) return; console.log(newVal); this.getSections(); }, }, mounted(){ this.getCounties(); } }); app.mount(\u0026#39;#app\u0026#39;); åŸ·è¡Œä¹‹å¾Œä½ æ‡‰è©²å¯ä»¥ç™¼ç¾å…©å€‹å•é¡Œï¼šé‚„æ²’æœ‰åˆå§‹åŒ–éçš„é¸å–®æœƒé•·çš„å¾ˆé†œï¼Œå’Œæˆ‘å€‘é æœŸçš„æ¨£å¼ä¸å¤ªä¸€æ¨£ï¼Œä»¥åŠï¼Œæˆ‘æ˜æ˜è³‡æ–™å…§å®¹æ›´æ–°äº†ï¼Œä½†ç‚ºç”šéº¼ç•«é¢ä¸Šä»ç„¶æ˜¯èˆŠçš„è³‡æ–™å‘¢ï¼Ÿæˆ‘çš„è³‡æ–™åˆå»å“ªè£¡äº† ğŸ˜ \nRefresh UI åœ¨å®˜æ–¹æ–‡ä»¶ Methods çš„é é¢ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€å€‹å«åš refresh çš„æ–¹æ³•ï¼Œé€™å€‹æ–¹æ³•å¯ä»¥è®“æˆ‘å€‘æ›´æ–°ç•«é¢ä¸Šçš„ UI å‘ˆç¾ï¼š\næ—¢ç„¶å®˜æ–¹éƒ½æä¾›äº†é€™å€‹ç”¨æ³•ï¼Œé‚£æˆ‘å€‘å°±ä¾ç…§å»ºè­°ä¿®æ”¹ä¸€ä¸‹ç¨‹å¼ç¢¼å§ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 // sample.js const app = Vue.createApp({ data(){...}, methods:{ getCounties(){ axios({ method: \u0026#39;get\u0026#39;, url: \u0026#39;./api/code\u0026#39; }).then(res =\u0026gt; { this.code.county = res.data; // è¨˜å¾—è¦åŒ…åœ¨ Vue.nextTick() ä¸­æ‰æœ‰æ•ˆå–” Vue.nextTick(() =\u0026gt; { $(\u0026#39;#county-select\u0026#39;).selectpicker(\u0026#39;refresh\u0026#39;); // æ›´æ–° county $(\u0026#39;#town-select\u0026#39;).selectpicker(\u0026#39;refresh\u0026#39;); // æ›´æ–° town $(\u0026#39;#section-select\u0026#39;).selectpicker(\u0026#39;refresh\u0026#39;); // æ›´æ–° section }) }) }, getTowns(){...}, getSections(){...}, }, watch:{...}, mounted(){ this.getCounties(); // ä¸€æ¬¡å…¨éƒ¨åˆå§‹åŒ– Vue.nextTick(() =\u0026gt; { $(\u0026#39;select\u0026#39;).selectpicker(); }) } }); app.mount(\u0026#39;#app\u0026#39;); è³‡æ–™çœ‹èµ·ä¾†æœ‰è¢«æ­£ç¢ºçš„æ›´æ–°åˆ° UI ä¸Šäº†ï¼Œä½†ç‚ºç”šéº¼æˆ‘çš„æ¸…å–®çœ‹èµ·ä¾†é‚„æ˜¯æ€ªæ€ªçš„å’§ ğŸ˜µ\nå…¶å¯¦ï¼Œåœ¨å®˜æ–¹çš„å®Œæ•´ç¯„ä¾‹ä¸­ï¼Œæ˜¯å…ˆæ‰¾åˆ°è¦åˆªé™¤çš„é¸é …ï¼Œç§»é™¤ä¹‹å¾Œæ‰é€²è¡Œ refreshï¼Œä½†ä¸æ›‰å¾—ç‚ºç”šéº¼ï¼Œå°±ç®—æŒ‰ç…§å®˜æ–¹çš„ç¯„ä¾‹æˆ‘ä¹Ÿç„¡æ³•æ­£å¸¸ç§»é™¤ ğŸ˜µ\nç”¨ Destoy ä¿®æ­£ æ‰€ä»¥æœ€å¾Œæˆ‘æ¡ç”¨çš„æ–¹æ³•ï¼Œæ˜¯ç›´æ¥æŠŠæ•´å€‹å…ƒä»¶ destroy æ‰ï¼Œæ›´æ–°è³‡æ–™çš„æ™‚å€™å†é‡æ–°å»ºç«‹ä¸€å€‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 Vue.nextTick(() =\u0026gt; { // å…ˆéŠ·æ¯€å†é‡å»º $(\u0026#39;#county-select\u0026#39;).selectpicker(\u0026#39;destroy\u0026#39;); $(\u0026#39;#county-select\u0026#39;).selectpicker(); $(\u0026#39;#town-select\u0026#39;).selectpicker(\u0026#39;destroy\u0026#39;); $(\u0026#39;#town-select\u0026#39;).selectpicker(); $(\u0026#39;#section-select\u0026#39;).selectpicker(\u0026#39;destroy\u0026#39;); $(\u0026#39;#section-select\u0026#39;).selectpicker(); }) çµ‚æ–¼å¯ä»¥çœ‹åˆ°æ­£ç¢ºçš„è³‡æ–™æœ‰è¢«å¥½å¥½åœ°å‘ˆç¾åœ¨ UI ä¸Šäº† ğŸŠ\nåƒè€ƒæ–‡ç« \nbootstrap-select å®˜æ–¹æ–‡ä»¶ ","date":"2022-08-14T01:13:23+08:00","permalink":"https://anthea-wu.github.io/post/vue-selected-dropdown-2/","title":"å¯ä»¥æŸ¥è©¢çš„ä¸‹æ‹‰å¼é¸å–® (2)"},{"content":"åœ¨å·¥ä½œä¸Šï¼ŒåŸºæœ¬éƒ½éœ€è¦é‡å°å„²å­˜çš„è³‡æ–™é€²è¡Œåˆ†é¡ï¼Œè€Œåœ¨åœ°ç†è³‡è¨Šçš„é ˜åŸŸä¸Šï¼Œæœ€å¸¸ä½¿ç”¨çš„ä¸€ç¨®åˆ†é¡æ–¹å¼å°±æ˜¯åœ°ç±ï¼Œåˆå¯ä»¥ç´°åˆ†ç‚ºç¸£å¸‚ã€é„‰é®å¸‚å€ã€åœ°æ®µç­‰è³‡è¨Šã€‚é‡å°é€™äº›åˆ†é¡çš„åç¨±ï¼Œç‰¹åˆ¥æ˜¯åœ°æ®µçš„å±¤ç´šï¼Œé€šå¸¸éƒ½æœƒæœ‰å¹¾åç­†è³‡æ–™ï¼Œå¦‚æœå–®ç´”ä½¿ç”¨ä¸‹æ‹‰å¼é¸å–®ï¼Œå°±æœƒæŠŠæ™‚é–“æµªè²»åœ¨èŒ«èŒ«å­—æµ·è£¡é¢é€²è¡Œæœå°‹ã€‚\nå¦‚æœä½¿ç”¨çš„å‰ç«¯æœ‰æ­é… Bootstrap æ¡†æ¶ï¼Œé€šå¸¸æœƒæŸ¥è©¢åˆ° bootstrap-select é€™å€‹å¥½ç”¨çš„å¥—ä»¶ ğŸ˜† æ¥ä¸‹ä¾†å°±è®“æˆ‘å€‘çœ‹ä¸€ä¸‹æ­é…ç°¡å–®çš„ API ï¼Œè¦æ€éº¼æŠŠ bootstrap-select å’Œ Vue ä¸€èµ·ä½¿ç”¨å§ã€‚\næº–å‚™è³‡æ–™ä¸¦å»ºç«‹ API åˆ©ç”¨åœ°ç±åœ–è³‡ç¶²è·¯ä¾¿æ°‘æœå‹™ç³»çµ±å–å¾—ç›¸é—œçš„ç¸£å¸‚é„‰é®æ¸…å–®å¾Œï¼Œæ•´ç†æˆ JSON æª”ï¼Œå†ä½¿ç”¨ API çš„æ–¹å¼æŠŠè³‡æ–™å‚³é€åˆ°å‰ç«¯ã€‚ä½œç‚ºç°¡å–®çš„ç¤ºç¯„ï¼Œæˆ‘åªæœ‰æ•´ç†å‡ºå°ä¸­å¸‚è¥¿å±¯å€ä»¥åŠæ–°åŒ—å¸‚ä¸‰å³½å€åº•ä¸‹çš„æ‰€æœ‰åœ°æ®µè™Ÿã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 using Microsoft.AspNetCore.Mvc; using Newtonsoft.Json; namespace bootstrap_selected_sample.Controllers; [ApiController] [Route(\u0026#34;api/[controller]\u0026#34;)] public class CodeController : ControllerBase { [HttpGet] public IActionResult Counties() { var path = \u0026#34;files/county.json\u0026#34;; var json = ReadFromJson(path); var info = JsonConvert.DeserializeObject\u0026lt;List\u0026lt;SimpleInfo\u0026gt;\u0026gt;(json); return Ok(info); } private string ReadFromJson(string path) { var reader = new StreamReader(path); var readToEnd = reader.ReadToEnd().Replace(\u0026#34;\\r\u0026#34;, \u0026#34;\u0026#34;).Replace(\u0026#34;\\n\u0026#34;, \u0026#34;\u0026#34;).Replace(\u0026#34; \u0026#34;, \u0026#34;\u0026#34;); return readToEnd; } } public class SimpleInfo { public string Id { get; set; } public string Name { get; set; } } è¼‰å…¥å¥—ä»¶ æ–¹ä¾¿èµ·è¦‹ï¼Œä¸‹é¢çš„ç¯„ä¾‹éƒ½æœƒä½¿ç”¨ç›´æ¥å¼•å…¥ CDN çš„æ–¹å¼ã€‚å¦å¤–è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ bootstrap-select å®˜æ–¹ç¶²ç«™ä¸Šæ‰€æä¾›çš„ CDN ç‰ˆæœ¬æ˜¯æ­é… bootstrap 4.Xï¼Œå¦‚æœä½ æ˜¯ä½¿ç”¨ bootstrap 5 çš„è©±ï¼Œè¦è¨˜å¾—åˆ° bootstrap-select çš„ GitHub æŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬çš„ CDN ç¶²å€å–”ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä½¿ç”¨åˆ°çš„å¥—ä»¶å’Œç‰ˆæœ¬ï¼š\nName Version Bootstrap 5.0.2 (css + js) bootstrap-select 1.14.0-beta3 (css + js) Vue.js 3 jQuery 3.6.0 axios ç„¡æŒ‡å®šç‰ˆæœ¬ ä½¿ç”¨ bootstrap-select æ¥ä¸‹ä¾†å°±è¦é–‹å§‹ä½¿ç”¨ bootstrap-select äº†ã€‚æŒ‰ç…§å®˜æ–¹æ–‡ä»¶çš„å¯«æ³•ï¼Œæœ€å¿«çš„æ–¹æ³•æ˜¯ç›´æ¥åœ¨ select ä¸­åŠ å…¥ selectpicker çš„ class å±¬æ€§ï¼Œæˆ–æ˜¯ä½¿ç”¨ JavaScript ä¾†é€²è¡Œåˆå§‹åŒ–ï¼š\n1 $(\u0026#39;#county-select\u0026#39;).selectpicker(); å¤§è‡´ä¸ŠçŸ¥é“æ€éº¼ä½¿ç”¨å¾Œï¼Œæ¥è‘—æˆ‘å€‘è¦åŠ å…¥ API æ‰€å›å‚³çš„è³‡æ–™ï¼Œé¦–å…ˆè©¦è©¦çœ‹æœ€ç°¡å–®çš„å…¨å°ç¸£å¸‚æ¸…å–®å§ï¼\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 \u0026lt;!-- sample.html --\u0026gt; \u0026lt;div id=\u0026#34;app\u0026#34; class=\u0026#34;container my-5\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;row\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;col-12 mt-5 row\u0026#34;\u0026gt; \u0026lt;form\u0026gt; \u0026lt;div class=\u0026#34;row g-3 align-items-center\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;col-auto\u0026#34;\u0026gt; \u0026lt;label for=\u0026#34;county-select\u0026#34; class=\u0026#34;col-form-label\u0026#34;\u0026gt;ç¸£å¸‚\u0026lt;/label\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;col-auto\u0026#34;\u0026gt; \u0026lt;select id=\u0026#34;county-select\u0026#34; class=\u0026#34;selectpicker\u0026#34;\u0026gt; \u0026lt;option v-for=\u0026#34;c in code.county\u0026#34; :value=\u0026#34;c.code\u0026#34;\u0026gt;{{c.name}}\u0026lt;/option\u0026gt; \u0026lt;/select\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 // sample.js const app = Vue.createApp({ data(){ return{ code:{ county: [] }, selected:{ county: null } } }, methods:{ getCounties(){ axios({ method: \u0026#39;get\u0026#39;, url: \u0026#39;./api/code\u0026#39; }).then(res =\u0026gt; { this.code.county = res.data; $(\u0026#39;#county-select\u0026#39;).selectpicker(); }) }, }, mounted(){ this.getCounties(); } }); app.mount(\u0026#39;#app\u0026#39;); ç•¶ä½ ç…§è‘—æ‰“ä¸Šé¢çš„å…§å®¹ä¸¦ä¸”é–‹å•Ÿç¶²é ä¹‹å¾Œï¼Œä½ æ‡‰è©²æœƒçœ‹åˆ°ä½ çš„ä¸‹æ‹‰å¼é¸å–®è£¡é¢ç”šéº¼éƒ½æ²’æœ‰ï¼Œä¸¦ä¸”ä¹Ÿæ²’æœ‰ä»»ä½•çš„éŒ¯èª¤è¨Šæ¯ã€‚\næˆ‘çš„æ¸…å–®å»å“ªè£¡äº† ï¼ˆä»¥ä¸‹çš†ç‚ºæˆ‘çš„ç†è§£ï¼Œå¦‚æœæœ‰èª¤é‚„è«‹å„ä½å¤§å¤§ä¸åæŒ‡æ­£ã€‚ï¼‰\næœƒé€ æˆé€™å€‹çµæœï¼Œæˆ‘çš„çŒœæ¸¬æ˜¯å› ç‚º Vue çš„ç”Ÿå‘½é€±æœŸçš„ç·£æ•…ã€‚è¢«åŒ…åœ¨ Vue æ›è¼‰ç¯„åœå…§çš„ html å…§å®¹ï¼Œæœƒåœ¨ app.mount('#app') åŸ·è¡Œä¹‹å¾Œï¼Œæ‰æ­£å¼çš„è¢«æ”¾åˆ° DOM å…ƒä»¶ä¸Šï¼Œä½†åœ¨é€™ä¹‹å‰ï¼Œä½ çš„ $('#county-select').selectpicker(); æœƒå…ˆå¹«ä½ æŠŠä¸‹æ‹‰å¼é¸å–®åˆå§‹åŒ–ï¼Œå¯æ˜¯é€™å€‹æ™‚å€™å…¶å¯¦é‚„æ²’æœ‰çœŸæ­£çš„æŠŠè³‡æ–™åˆ©ç”¨ v-for æ”¾å…¥ä¸‹æ‹‰å¼é¸å–®çš„å…§å®¹ä¸­ï¼Œæ‰€ä»¥ bootstrap-select èªç‚ºé€™æ˜¯ä¸€å€‹ç©ºçš„é¸å–®ï¼Œè‡ªç„¶è€Œç„¶åˆå§‹åŒ–çš„çµæœå°±æœƒæ˜¯ç©ºçš„äº†ã€‚\nè¦è§£æ±ºé€™å€‹å•é¡Œï¼Œå¯ä»¥ä½¿ç”¨ Vue ä¸­çš„ä¸€å€‹ function nextTick()ã€‚ä»–æœƒåœ¨æ•´å€‹ DOM éƒ½æ›è¼‰å®Œæˆä¹‹å¾Œï¼Œæ‰å»é€²è¡Œå¯«åœ¨ nextTick() å…§çš„ç¨‹å¼ç¢¼ã€‚åŸæœ¬çš„ç”¨æ„å…¶å¯¦æ˜¯åœ¨æ–¼éåŒæ­¥æ›´æ–°ï¼Œç¯€çœæ•ˆèƒ½ã€‚\nä½¿ç”¨ nextTick() 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 // sample.js const app = Vue.createApp({ data(){ return{ code:{ county: [] }, selected:{ county: null } } }, methods:{ getCounties(){ axios({ method: \u0026#39;get\u0026#39;, url: \u0026#39;./api/code\u0026#39; }).then(res =\u0026gt; { this.code.county = res.data; // åŸæœ¬çš„ç¨‹å¼ç¢¼ // $(\u0026#39;#county-select\u0026#39;).selectpicker(); // ä½¿ç”¨ nextTick() åŒ…èµ·ä¾† Vue.nextTick(() =\u0026gt; { $(\u0026#39;#county-select\u0026#39;).selectpicker(); }) }) }, }, mounted(){ this.getCounties(); } }); app.mount(\u0026#39;#app\u0026#39;); åˆ©ç”¨å‰›å‰›å­¸åˆ°çš„ Vue.nextTick() æ›´æ–°å®Œç¨‹å¼ç¢¼ä¹‹å¾Œï¼Œä½ æ‡‰è©²å°±å¯ä»¥é †åˆ©çœ‹åˆ°æˆ‘å€‘æˆåŠŸæ¥å› API çš„çµæœäº†ï¼š\nä»¥ä¸Šå°±æ˜¯åŸºæœ¬çš„ bootstrap-select ä½¿ç”¨æ–¹å¼ã€‚ä¸‹ä¸€ç¯‡æœƒæ¥è‘—ä»‹ç´¹æ›´é€²éšçš„ç”¨æ³•ï¼ŒåŒ…å«å¦‚æœæˆ‘è¦å‹•æ…‹çš„è®Šæ›´ä¸‹æ‹‰å¼é¸å–®ï¼Œä¾‹å¦‚ï¼šé¸æ“‡å°ä¸­å¸‚ï¼Œå°±åªæœƒå‡ºç¾å°ä¸­çš„é„‰é®å¸‚å€é¸å–®ï¼Œæœƒé‡åˆ°ç”šéº¼æ¨£çš„å•é¡Œå’Œè§£æ³•ã€‚\næ„Ÿè¬ä½ çš„æ”¶çœ‹ï¼\nåƒè€ƒæ–‡ç« \nvue.nextTick()æ–¹æ³•çš„ä½¿ç”¨è©³è§£ bootstrap-select å®˜æ–¹æ–‡ä»¶ ","date":"2022-08-07T00:58:03+08:00","permalink":"https://anthea-wu.github.io/post/vue-selected-dropdown-1/","title":"å¯ä»¥æŸ¥è©¢çš„ä¸‹æ‹‰å¼é¸å–® (1)"},{"content":"å‰å…©ç¯‡æ–‡ç« èªªæ˜äº†å¦‚ä½•è®€å– Shapefileï¼Œæ¥ä¸‹ä¾†è¦ä»‹ç´¹çš„æ˜¯å¦‚ä½•ç”Ÿæˆä¸€å€‹ Shapefile æª”æ¡ˆã€‚\nå»ºç«‹ Shapefile æª”æ¡ˆ åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å€‘è®€å–çš„æª”æ¡ˆåŒ…å«äº†ä¸‰å€‹è³‡è¨Šï¼šIDã€åœŸåœ°åç¨±é‚„æœ‰åœŸåœ°é¢ç©ã€‚æ‰€ä»¥å°±æŒ‰ç…§é€™å€‹ç°¡å–®çš„ç¯„ä¾‹ï¼Œä¾†å»ºç«‹ä¸€å€‹ Shapefile æª”æ¡ˆå§ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 // è¨»å†Š MaxRev.Gdal.Core GdalBase.ConfigureAll(); // è¨»å†Š GDAL Gdal.SetConfigOption(\u0026#34;SHAPE_ENCODING\u0026#34;, \u0026#34;big5\u0026#34;); Gdal.AllRegister(); Ogr.RegisterAll(); // å»ºç«‹ Driver var driver = Ogr.GetDriverByName(\u0026#34;ESRI Shapefile\u0026#34;); var source = driver.CreateDataSource(\u0026#34;files/simple/create.shp\u0026#34;, null); // åº§æ¨™ç³»çµ±è¨­å®š var spatialReference = new SpatialReference(\u0026#34;\u0026#34;); spatialReference.SetWellKnownGeogCS(\u0026#34;WGS84\u0026#34;); // å»ºç«‹ Field var layer = source.CreateLayer(\u0026#34;layer one\u0026#34;, new SpatialReference(), wkbGeometryType.wkbPolygon, null); var fieldId = new FieldDefn(\u0026#34;Id\u0026#34;, FieldType.OFTInteger); layer.CreateField(fieldId, (int)EnumShapefileColumn.Id); var fieldName = new FieldDefn(\u0026#34;åœŸåœ°åç¨±\u0026#34;, FieldType.OFTString); layer.CreateField(fieldName, (int)EnumShapefileColumn.Name); var fieldArea = new FieldDefn(\u0026#34;åœŸåœ°é¢ç©\u0026#34;, FieldType.OFTString); layer.CreateField(fieldArea, (int)EnumShapefileColumn.Area); // å»ºç«‹ Feature var field = layer.GetLayerDefn(); var feature = new Feature(field); // è¨­å®šå…§å®¹ feature.SetField((int)EnumShapefileColumn.Id, 1); feature.SetField((int)EnumShapefileColumn.Name, \u0026#34;ç¬¬äºŒå¡ŠåœŸåœ°\u0026#34;); feature.SetField((int)EnumShapefileColumn.Area, \u0026#34;123.4\u0026#34;); // è¨­å®šç©ºé–“è³‡è¨Š var wkt = \u0026#34;POLYGON ((-1.13755980861244 0.746411483253589,-0.350478468899522 0.488038277511962,-1.06578947368421 -0.028708133971292,-1.13755980861244 0.746411483253589))\u0026#34;; var geometry = Geometry.CreateFromWkt(wkt); feature.SetGeometry(geometry); layer.CreateFeature(feature); Error 1: cannot convert to big5 å¦‚æœä½ åŸå°ä¸å‹•æŠŠä¸Šé¢çš„ç¨‹å¼ç¢¼è¤‡è£½è²¼ä¸ŠåŸ·è¡Œçš„è©±ï¼Œæ‡‰è©²æœƒé‡åˆ°ç¬¬ä¸€å€‹éŒ¯èª¤ï¼š\né€™å€‹éŒ¯èª¤çš„åŸå› é›–ç„¶æœ‰æŸ¥è©¢åˆ°ç›¸é—œçš„è¨è«–ï¼Œä½†æˆ‘æ²’æœ‰çœ‹çš„å¾ˆæ‡‚ ğŸ˜¢ ä¸éè¦è§£æ±ºé€™å€‹å•é¡Œæœ€ç°¡å–®çš„æ–¹æ³•å°±æ˜¯æŠŠç¬¬äº”è¡Œçš„éƒ¨åˆ†é€²è¡Œä¸‹é¢çš„ä¿®æ”¹ï¼š\n1 2 3 4 5 // é€ æˆéŒ¯èª¤ // Gdal.SetConfigOption(â€œSHAPE_ENCODINGâ€, â€œbig5â€); // ä¿®å¾© Gdal.SetConfigOption(â€œSHAPE_ENCODINGâ€, â€œâ€); å¥½çš„ï¼Œç¨‹å¼çœ‹èµ·ä¾†å¯ä»¥é †åˆ©åŸ·è¡Œäº†ï¼ä¸éé€™æ¨£å°±æœƒè®“å‰å…©ç¯‡æ–‡ç« çš„ä¸­æ–‡è®€å–è®Šæˆäº‚ç¢¼ï¼Œæš«æ™‚é‚„æ²’æœ‰æ›´å¥½çš„è§£æ³•ï¼Œæ‰€ä»¥å°±å…ˆå°‡å°±ä¸€ä¸‹ï¼ŒæŠŠè®€å¯«çš„è¨»å†Šåˆ†é–‹ä¾†å§ã€‚\nError 2: ä¸­æ–‡äº‚ç¢¼ æ¥ä¸‹ä¾†è®“æˆ‘å€‘ç”¨ QGIS æª¢è¦–ä¸€ä¸‹æˆ‘å€‘æ‰€ç”¢ç”Ÿçš„ Shapefile æª”æ¡ˆï¼š\nç¬¬äºŒå€‹å•é¡Œå‡ºç¾äº†ï¼ŒField å¦‚æœä½¿ç”¨ä¸­æ–‡çš„è©±æœƒè®Šæˆäº‚ç¢¼ã€‚ä¸éç¥å¥‡çš„æ˜¯ï¼Œç•¶æˆ‘å€‘å» QGIS åœ¨çš„è¨­å®šä¸­ï¼ŒæŠŠ Data Source Encoding å¾ UTF-8 èª¿æ•´ç‚º BIG-5 ä¹‹å¾Œï¼Œäº‚ç¢¼çš„æƒ…å½¢å°±åéä¾†äº†ï¼š\né€™å€‹å•é¡Œå’Œä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œä¸­æ–‡äº‚ç¢¼çš„å•é¡ŒåŸå› ç›¸ä¼¼ï¼Œåœ¨å¥—ä»¶ä¸­ä¸€å€‹æœ‰å…ˆè¢«è½‰ç‚º UTF-8 çš„ç·¨ç¢¼ï¼Œä¸€å€‹æ²’æœ‰ï¼Œæ‰€ä»¥é€ æˆé€™æ¨£çš„æƒ…æ³ç™¼ç”Ÿã€‚\nè§£æ±ºä¸­æ–‡ç·¨ç¢¼ä¸åŒçš„å•é¡Œ æœ€ä¸€é–‹å§‹ä»¥ç‚ºé€™å€‹å•é¡Œå¾ˆç°¡å–®ï¼Œæ—¢ç„¶ç·¨ç¢¼ä¸ä¸€æ¨£ï¼Œé‚£æˆ‘å°±å…ˆè½‰å¥½å†é€é€²å»å°±æ‡‰è©²å¯ä»¥äº†å§ï¼çµæœä»–çš„ç·¨ç¢¼æ˜¯åœ¨åŸç”Ÿçš„ dll è£¡é¢é€²è¡Œçš„ï¼Œæˆ‘åœ¨å¤–é¢å…ˆè½‰å¥½ä¸€æ¬¡ä¸€æ¨£æ²’æœ‰ç”¨â€¦â€¦\næ–¼æ˜¯å°±æƒ³èªªï¼Œæ—¢ç„¶è·Ÿä¸Šä¸€ç¯‡æ–‡ç« æ˜¯å·®ä¸å¤šçš„å•é¡Œï¼Œé‚£å°±ä½¿ç”¨å·®ä¸å¤šçš„æ–¹å¼ï¼Œè®€å–åŸç”Ÿçš„ method ç›´æ¥é€²è¡Œèª¿ç”¨å³å¯ï¼Œä½†å»æœƒä¸€ç›´é‡åˆ° Attempted to read or write protected memory. This is often an indication that other memory is corrupt. çš„å•é¡Œï¼Œå› æ­¤ä¹Ÿæ”¾æ£„äº†é€™å€‹è§£æ³•ã€‚\næœ€å¾Œæ˜¯æŸ¥å°‹åˆ°ä¸€ç¯‡æ–‡ç« ï¼ŒæŠŠ feature.SetField æ”¹æˆèª¿ç”¨ SetFieldBinaryFromHexString å°±å®Œç¾çš„è§£æ±ºå•é¡Œäº†ï¼ä¸éæ–¹æ³•åç¨±éƒ½æ˜ç¢ºçš„é¡¯äº†è¦ä½¿ç”¨ Hex stringï¼Œæ‰€ä»¥éœ€è¦åˆ©ç”¨ä¸‹é¢çš„æ–¹æ³•ä¾†æŠŠåŸæœ¬çš„å­—ä¸²ç¨ä½œè½‰æ›ï¼š\n1 2 3 4 5 // .NET Core ä½¿ç”¨éœ€å®‰è£ Nuget å¥—ä»¶ System.Text.Encoding.CodePages // Encoding.RegisterProvider(CodePagesEncodingProvider.Instance); // å¯ä»¥åŠ åœ¨ä½¿ç”¨å‰ï¼Œæˆ–æ˜¯ Program.cs var bytes = Encoding.GetEncoding(950).GetBytes(\u0026#34;ç¬¬äºŒå¡ŠåœŸåœ°\u0026#34;); var hexString = Convert.ToHexString(bytes); æœ€å¾Œæª¢è¦–ä¸€ä¸‹æˆ‘å€‘ç”Ÿç”¢çš„ Shapefile æª”æ¡ˆï¼Œé‚„å¯ä»¥ç™¼ç¾å…©å€‹å°å•é¡Œï¼š\nError 3: é è¨­ç·¨ç¢¼ å¦‚æœæ˜¯å…ˆè½‰æˆ BIG-5 å†è½‰ Hex stringï¼Œå¯ä»¥ç™¼ç¾ä¸€é–‹å§‹æ‰“é–‹çš„æ™‚å€™é‚„æ˜¯äº‚ç¢¼ï¼Œéœ€è¦åˆ°è¨­å®šè£¡é¢æŠŠ Data Source Encoding èª¿æ•´ç‚º BIG-5 å¾Œæ‰èƒ½æ­£å¸¸é¡¯ç¤ºã€‚é€™å€‹éƒ¨åˆ†åªéœ€è¦åœ¨å»ºç«‹ Layer çš„æ™‚å€™æŠŠæœ€å¾Œä¸€å€‹åƒæ•¸åŠ ä¸Š Encoding çš„è¨­å®šå³å¯ï¼š\n1 2 3 4 5 6 // åŸæœ¬çš„è¨­å®š var layer = source.CreateLayer(\u0026#34;layer one\u0026#34;, new SpatialReference(\u0026#34;\u0026#34;), wkbGeometryType.wkbPolygon, null); // æ–°å¢ Encoding ç‚º BIG-5 var layer = source.CreateLayer(\u0026#34;layer one\u0026#34;, new SpatialReference(\u0026#34;\u0026#34;), wkbGeometryType.wkbPolygon, new[]{\u0026#34;ENCODING=BIG5\u0026#34;}); Error 4: åº§æ¨™ç³»çµ± ä¸€èˆ¬ä¾†èªªï¼ŒShapefile å¿…é ˆè¦æœ‰æŒ‡å®šçš„åº§æ¨™ç³»çµ±ï¼Œæ²’æœ‰çš„è©±å¯èƒ½æœƒåœ¨è®€å–ä¸Šé‡åˆ°ä¸€äº›å•é¡Œï¼Œé€ æˆå¾ŒçºŒçš„æ“ä½œéŒ¯èª¤ï¼Œä¾‹å¦‚ï¼šè½‰æˆ WKT å’Œç¾å­˜çš„è³‡æ–™è¦é€²è¡Œæ¯”å°çš„æ™‚å€™ï¼Œå¯èƒ½å°±æœƒå› ç‚ºåº§æ¨™ç³»çµ±çš„ä¸åŒè€Œéœ€è¦é€²è¡Œè½‰æ›ã€‚\nè¨­å®šåº§æ¨™ç³»çµ±çš„æ–¹æ³•å¾ˆç°¡å–®ï¼š\n1 2 3 4 5 6 7 8 // åŸæœ¬ var layer = source.CreateLayer(\u0026#34;layer one\u0026#34;, new SpatialReference(), wkbGeometryType.wkbPolygon, new[]{\u0026#34;ENCODING=BIG5\u0026#34;}); // è¨­å®šåº§æ¨™ç³»çµ±ç‚º WGS84 var spatialReference = new SpatialReference(\u0026#34;\u0026#34;); spatialReference.SetWellKnownGeogCS(\u0026#34;WGS84\u0026#34;); var layer = source.CreateLayer(\u0026#34;layer one\u0026#34;, spatialReference, wkbGeometryType.wkbPolygon, new[]{\u0026#34;ENCODING=BIG5\u0026#34;}); æœ€çµ‚ç‰ˆç¨‹å¼ç¢¼ ç¶“éä¸Šé¢çš„ä¿®æ­£å’Œèª¿æ•´ä¹‹å¾Œï¼Œå®Œæ•´çš„ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 // è¨»å†Š MaxRev.Gdal.Core GdalBase.ConfigureAll(); // è¨»å†Š GDAL Gdal.SetConfigOption(\u0026#34;SHAPE_ENCODING\u0026#34;, \u0026#34;big5\u0026#34;); Gdal.AllRegister(); Ogr.RegisterAll(); // å»ºç«‹ Driver var driver = Ogr.GetDriverByName(\u0026#34;ESRI Shapefile\u0026#34;); var source = driver.CreateDataSource(\u0026#34;files/simple/create.shp\u0026#34;, null); // åº§æ¨™ç³»çµ±è¨­å®š var spatialReference = new SpatialReference(\u0026#34;\u0026#34;); spatialReference.SetWellKnownGeogCS(\u0026#34;WGS84\u0026#34;); // å»ºç«‹ Field var spatialReference = new SpatialReference(\u0026#34;\u0026#34;); spatialReference.SetWellKnownGeogCS(\u0026#34;WGS84\u0026#34;); var layer = source.CreateLayer(\u0026#34;layer one\u0026#34;, spatialReference, wkbGeometryType.wkbPolygon, new[]{\u0026#34;ENCODING=BIG5\u0026#34;}); var fieldId = new FieldDefn(\u0026#34;Id\u0026#34;, FieldType.OFTInteger); layer.CreateField(fieldId, (int)EnumShapefileColumn.Id); var fieldName = new FieldDefn(\u0026#34;åœŸåœ°åç¨±\u0026#34;, FieldType.OFTString); layer.CreateField(fieldName, (int)EnumShapefileColumn.Name); var fieldArea = new FieldDefn(\u0026#34;åœŸåœ°é¢ç©\u0026#34;, FieldType.OFTString); layer.CreateField(fieldArea, (int)EnumShapefileColumn.Area); // å»ºç«‹ Feature var field = layer.GetLayerDefn(); var feature = new Feature(field); // è¨­å®šå…§å®¹ var bytes = Encoding.GetEncoding(950).GetBytes(\u0026#34;ç¬¬äºŒå¡ŠåœŸåœ°\u0026#34;); var hexString = Convert.ToHexString(bytes); feature.SetField((int)EnumShapefileColumn.Id, 1); feature.SetField((int)EnumShapefileColumn.Name, hexString); feature.SetField((int)EnumShapefileColumn.Area, \u0026#34;123.4\u0026#34;); // è¨­å®šç©ºé–“è³‡è¨Š var wkt = \u0026#34;POLYGON ((-1.13755980861244 0.746411483253589,-0.350478468899522 0.488038277511962,-1.06578947368421 -0.028708133971292,-1.13755980861244 0.746411483253589))\u0026#34;; var geometry = Geometry.CreateFromWkt(wkt); feature.SetGeometry(geometry); layer.CreateFeature(feature); æ„Ÿè¬å¤§å®¶çš„è§€çœ‹ï¼æœ‰ä»»ä½•éŒ¯èª¤é‚„è«‹å„ä½å¤§å¤§ä¸åæŒ‡æ•™ï¼Œæœ‰ä»»ä½•å•é¡Œä¹Ÿæ­¡è¿ä¾†ä¿¡è·Ÿæˆ‘è¨è«–å–” ğŸ˜‰\nåƒè€ƒæ–‡ç« \ngdal for android é–‹ç™¼åŒ…ï¼Œå­—æ®µå±¬æ€§ç‚ºä¸­æ–‡å‡ºç¾äº‚ç¢¼ ","date":"2022-07-31T00:43:50+08:00","permalink":"https://anthea-wu.github.io/post/gdal-shapefile-3/","title":"GDAL æ“ä½œ ShapeFile (3)"},{"content":"\nä¸Šä¸€ç¯‡æåˆ°ï¼Œè¼¸å‡ºçš„çµæœä¸­ï¼Œæ¬„ä½çš„åç¨±å¯ä»¥æ­£å¸¸é¡¯ç¤ºï¼Œå…§å®¹çš„å€¼å»æœƒè®Šæˆäº‚ç¢¼ã€‚\nå•é¡Œå‡ºåœ¨å“ª ä¸Šç¶²æ‰¾è§£æ³•çš„æ™‚å€™ç™¼ç¾æœ‰äººé‡åˆ°ç›¸ä¼¼çš„ç‹€æ³ï¼Œä½†ä¸åŒçš„æ˜¯ï¼Œæˆ‘å’Œå°æ–¹çš„äº‚ç¢¼é¡¯ç¤ºæ˜¯ç›¸åçš„ï¼šä»–çš„äº‚ç¢¼æœƒå‡ºç¾åœ¨æ¬„ä½åç¨±ï¼Œå…§å®¹çš„å€¼åè€Œæ˜¯æ­£å¸¸çš„ã€‚\né›–ç„¶ç‹€æ³æœ‰é»ä¸ç›¸åŒï¼Œä½†ä»–åœ¨é–±è®€äº†åŸå§‹ç¢¼å¾Œæå‡ºäº†ä¸€å€‹è§€é»ï¼š\nå°æ¯” GetName å’Œ GetFieldAsString å…©å€‹å‡½æ•¸å¯ä»¥å¾ˆæ˜é¡¯çœ‹å‡ºä¾†ï¼ŒGetFieldAsString é€šéèª¿ç”¨ Ogr.Utf8BytesToString å°‡è¿”å›çš„ UTF8 ç·¨ç¢¼çš„ä½å…ƒçµ„æ•¸çµ„ä»¥ UTF8 æ–¹å¼è§£ç¢¼ç‚ºå­—å…ƒä¸²ï¼Œæ‰€ä»¥èƒ½å¤ æ­£å¸¸é¡¯ç¤ºï¼›è€Œ GetName å‰‡ç›´æ¥è¿”å›å­—å…ƒä¸²ï¼ˆå¯¦éš›ä¸Šç·¨è­¯å™¨éš±æ€§èª¿ç”¨äº† Encoding.Default.GetString è§£ç¢¼ç‚ºå­—å…ƒä¸²ï¼‰ï¼Œç”±æ–¼æ²’æœ‰ä½¿ç”¨ UTF8 è§£ç¢¼å°è‡´é¡¯ç¤ºç‚ºäº‚ç¢¼ã€‚\nâ€• gis0911178, CSDN / CC 4.0 BY-SA å”è­° è§€å¯ŸåŸå§‹ç¢¼ ç‚ºäº†è­‰æ˜ï¼Œæˆ‘åˆ©ç”¨åç·¨è­¯çš„å·¥å…·ä¾†æª¢è¦– Gdal.Core.dllï¼Œå¯ä»¥çœ‹åˆ°åƒä¸‹é¢é€™æ¨£çš„å…§å®¹ï¼š\nå¾é€™å…©å¼µåœ–ä¸­å¯ä»¥çœ‹åˆ°ï¼Œè®€å–å…§å®¹å€¼ï¼Œèª¿ç”¨ Feature.GetFieldAsString() çš„æ™‚å€™ï¼Œæœƒå°‡çµæœé€²è¡Œè½‰æ›ï¼ŒUtf8BytesToString() çš„å…§å®¹åŒ…å«ï¼š\næ‰€ä»¥å¾çµè«–ä¾†çœ‹ï¼Œä»–çš„æƒ…æ³æ‡‰è©²æ˜¯æ­£å¸¸çš„ï¼Œåªæ˜¯ä¸çŸ¥é“ç‚ºç”šéº¼æˆ‘æœƒæ˜¯ç›¸åçš„ç‹€æ³ï¼šæœ‰ç”¨ UTF8 è§£ç¢¼çš„å…§å®¹ï¼Œåè€Œæœƒæ˜¯äº‚ç¢¼ ğŸ˜•\nGdal.Core â†’ MaxRev.Gdal.Core æ‰€ä»¥ï¼ŒæŒ‰ç…§ä»–çš„å‡è¨­ï¼Œæ‡‰è©²æ˜¯è¦åœ¨å–å¾—æ¬„ä½åç¨±çš„æ™‚å€™å¤šèª¿ç”¨ Utf8BytesToString() ä¾†è®“å­—ä¸²æ­£ç¢ºé¡¯ç¤ºï¼Œä½†å°æ–¼æˆ‘çš„ç‹€æ³ä¾†èªªï¼Œåè€Œæ˜¯è¦æŠŠ Utf8BytesToString() æ‹¿æ‰ ğŸ˜¢ ä½†æˆ‘å°æ–¼ dll ç›¸é—œçš„æŠ€èƒ½æ¨¹æ˜¯æœªé–‹é€šçš„ç‹€æ…‹ï¼Œæ‰€ä»¥é¸æ“‡æ”¾æ£„ Gdal.Core é€™å€‹å¥—ä»¶ï¼Œè½‰è€Œä½¿ç”¨å¦å¤–ä¸€å€‹åŒæ¨£ä½¿ç”¨ Gdalï¼Œä½†å°ˆé–€é–‹ç™¼çµ¦ .NET Core ä½¿ç”¨çš„å¥—ä»¶ï¼ï¼ MaxRev.Gdal.Coreã€‚\nå¥—ä»¶çš„ä½¿ç”¨æ–¹æ³•å’ŒåŸæœ¬çš„ Gdal.Core ä¸€æ¨¡ä¸€æ¨£ï¼Œåªæ˜¯è¦åœ¨åŸæœ¬çš„ Gdal.AllRegister(); ä¹‹å‰ï¼ŒåŠ ä¸Š GdalBase.ConfigureAll(); å°±å¯ä»¥äº†ã€‚æ›´æ”¹å¥—ä»¶ä¹‹å¾Œé‹è¡Œçš„çµæœå¦‚ä¸‹ï¼š\nä¿®æ­£ä¸­æ–‡äº‚ç¢¼ å°‡æƒ…å¢ƒé‚„åŸä¹‹å¾Œå°±å¯ä»¥é‡å°ä»–æ‰€æå‡ºçš„æ–¹æ³•é€²è¡Œä¿®æ­£äº†ã€‚æˆ‘é¸æ“‡æœ€å¿«ä¹Ÿæœ€å¥½è™•ç†çš„æ–¹æ³•ï¼ï¼ç›´æ¥èª¿ç”¨åŸæœ¬ dll ä¸­çš„æ–¹æ³•å†å¦å¤–åŒ…ä¸€å±¤ UTF8 è§£ç¢¼ï¼Œå®Œæ•´çš„ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 // è¨»å†Š MaxRev.Gdal.Core GdalBase.ConfigureAll(); // è¨»å†Š GDAL Gdal.SetConfigOption(\u0026#34;SHAPE_ENCODING\u0026#34;, \u0026#34;big5\u0026#34;); Gdal.AllRegister(); Ogr.RegisterAll(); // é–‹å•Ÿ SHP æª”æ¡ˆï¼ˆ0 - è®€å–ã€1 - è®€å¯«ï¼‰ var source = Ogr.Open(\u0026#34;files/simple/test.shp\u0026#34;, (int)EnumShapefileOpen.ReadOnly); var layerCount = source.GetLayerCount(); for (var i = 0; i \u0026lt; layerCount; i++) { // è®€å–åœ–å±¤ Layer è³‡è¨Š var layer = source.GetLayerByIndex(i); var fieldCount = layer.GetLayerDefn().GetFieldCount(); for (var j = 0; j \u0026lt; fieldCount; j++) { var field = layer.GetLayerDefn().GetFieldDefn(j); var fieldName = GetFieldDfnName(field); Console.WriteLine($\u0026#34;æ¬„ä½{j + 1}. {fieldName}\u0026#34;); } // è®€å–è¦ç´  Feature Feature feature; while ((feature = layer.GetNextFeature()) != null) { var id = feature.GetFieldAsInteger(0); Console.WriteLine($\u0026#34;å…§å®¹1. {id}\u0026#34;); var name = feature.GetFieldAsString(1); Console.WriteLine($\u0026#34;å…§å®¹2. {name}\u0026#34;); var area = feature.GetFieldAsInteger64(2); Console.WriteLine($\u0026#34;å…§å®¹3. {area}\u0026#34;); var geometry = feature.GetGeometryRef(); geometry.ExportToWkt(out var wkt); Console.WriteLine($\u0026#34;- WKT: {wkt}\u0026#34;); } } static string? Utf8BytesToString(IntPtr ptr) { if (ptr == IntPtr.Zero) return null; var ms = new MemoryStream(); byte b; var ofs = 0; while ((b = Marshal.ReadByte(ptr, ofs++)) != 0) { ms.WriteByte(b); } return Encoding.UTF8.GetString(ms.ToArray()); } // Dll çš„ä½ç½®è¦æ³¨æ„ [DllImport(\u0026#34;gdal/x64/gdal305.dll\u0026#34;, EntryPoint = \u0026#34;OGR_Fld_GetNameRef\u0026#34;, CallingConvention = CallingConvention.Cdecl)] static extern IntPtr OGR_Fld_GetNameRef(HandleRef handle); static string GetFieldDfnName(FieldDefn fieldDefn) { HandleRef handle = FieldDefn.getCPtr(fieldDefn); IntPtr ptr = OGR_Fld_GetNameRef(handle); return Utf8BytesToString(ptr); } public enum EnumShapefileOpen { ReadOnly } åŸ·è¡Œä¹‹å¾Œå°±å¯ä»¥çœ‹åˆ°æˆ‘å€‘æŠŠé€™å€‹äº‚ç¢¼ä¿®å¥½å•¦ï¼\nåƒè€ƒæ–‡ç« \nC#ä¸­ä½¿ç”¨GDAL3ï¼ˆäºŒï¼‰ï¼šWindowsä¸‹è¯»å†™Shapeæ–‡ä»¶åŠè¶…è¯¦ç»†è§£å†³ä¸­æ–‡ä¹±ç é—®é¢˜ ","date":"2022-07-24T23:58:59+08:00","permalink":"https://anthea-wu.github.io/post/gdal-shapefile-2/","title":"GDAL æ“ä½œ ShapeFile (2)"},{"content":"é›–ç„¶å…¬å¸çš„ç”¢å“ä»¥ APP ç‚ºä¸»ï¼Œä½†èº«ç‚ºä¸€å€‹å¾Œç«¯å·¥ç¨‹å¸«ï¼Œåç‰‡ä¸Šæ›è‘— GIS çš„é ­éŠœï¼Œä¸€äº›åŸºæœ¬çš„åœ°ç†è³‡è¨ŠæŠ€è¡“é‚„æ˜¯è¦ç¨å¾®ç¢°ä¸€ä¸‹çš„ã€‚å¹³å¸¸æ¥è§¸æœ€å¤šçš„å°±æ˜¯æœ‰ç´€éŒ„ç©ºé–“è³‡è¨Šçš„ Shapefileï¼Œæœƒéœ€è¦é€²è¡Œçš„æ“ä½œåŒ…å«è®€å–å®ƒçš„ç©ºé–“è³‡è¨Šã€æ¯å€‹ç©ºé–“è³‡è¨Šä¸Šçš„å±¬æ€§ï¼Œä»¥åŠåˆ©ç”¨ç©ºé–“è³‡è¨Šåšäº¤é›†æˆ–åŒ…å«çš„æ¯”å°ã€‚\nä¸€å€‹ Shape æ–‡ä»¶åŒ…æ‹¬ä¸‰å€‹æ–‡ä»¶ï¼šä¸€å€‹ä¸»æ–‡ä»¶ .shpï¼Œä¸€å€‹ç´¢å¼•æ–‡ä»¶ .shxï¼Œå’Œä¸€å€‹ dBASE è¡¨ .dbfã€‚\nä¸»æ–‡ä»¶æ˜¯ä¸€å€‹ç›´æ¥å­˜å–ï¼Œè®Šé•·åº¦ç´€éŒ„çš„æ–‡ä»¶ï¼Œå…¶ä¸­æ¯å€‹ç´€éŒ„æè¿°æ§‹æˆä¸€å€‹åœ°ç†ç‰¹å¾ Feature çš„æ‰€æœ‰ vertices åº§æ¨™å€¼ã€‚\nåœ¨ç´¢å¼•æ–‡ä»¶ä¸­ï¼Œæ¯æ¢è¨˜éŒ„åŒ…å«å°æ‡‰ä¸»æ–‡ä»¶è¨˜éŒ„è·é›¢ä¸»æ–‡ä»¶é ­é–‹å§‹çš„åç§»é‡ã€‚\ndBASE è¡¨åŒ…å« SHP æ–‡ä»¶ä¸­æ¯ä¸€å€‹ Feature çš„ç‰¹å¾µå±¬æ€§ï¼Œè¡¨ä¸­å¹¾ä½•ç´€éŒ„å’Œå±¬æ€§æ•¸æ“šä¹‹é–“çš„ä¸€ä¸€å°æ‡‰é—œä¿‚æ˜¯åŸºæ–¼è¨˜éŒ„æ•¸ç›®çš„ IDã€‚åœ¨ dBASE æ–‡ä»¶ä¸­çš„å±¬æ€§è¨˜éŒ„å¿…é ˆå’Œä¸»æ–‡ä»¶ä¸­çš„è¨˜éŒ„é¡ºåºæ˜¯ç›¸åŒçš„ã€‚åœ–å½¢æ•¸æ“šå’Œå±¬æ€§æ•¸æ“šé€šéç´¢å¼•è™Ÿå»ºç«‹ä¸€ä¸€å°æ‡‰çš„é—œä¿‚ã€‚\nâ€• gis0911178, CSDN / CC 4.0 BY-SA å”è­° æˆ‘å° Shapefile çš„ç†è§£ä¹Ÿé‚„ä¸é€å¾¹ï¼Œä½†å¾ä¸Šé¢æ“·å–çš„æ–‡ç« ä¸­å¯ä»¥çœ‹å‡ºä¸€ä»¶äº‹æƒ…æ˜¯ï¼šä¸€å€‹æ­£å¸¸çš„ Shapefile æª”æ¡ˆå¿…é ˆè‡³å°‘åŒ…å«ä¸‰å€‹å‰¯æª”åçš„æª”æ¡ˆï¼Œè€Œå…¶ä¸­åœ¨æˆ‘çš„å·¥ä½œä¸Šï¼Œæœƒéœ€è¦å–å¾—çš„è³‡æ–™ï¼Œä¸€æ˜¯åœ¨ .shp ä¸­è¨˜éŒ„çš„ç©ºé–“è³‡è¨Šï¼ŒäºŒæ˜¯åœ¨ .dbf ä¸­è¨˜éŒ„çš„å…¶ä»–å±¬æ€§ã€‚ä¸éè¦æ³¨æ„çš„æ˜¯ï¼Œ.shp æª”æ¡ˆæ˜¯ç„¡æ³•å–®ç¨è¢«è®€å–çš„ï¼Œå¦‚æœè¦å° Shapefile é€²è¡Œä»»ä½•æ“ä½œï¼ŒåŒä¸€å€‹è³‡æ–™å¤¾ åº•ä¸‹å°±å¿…é ˆåŒæ™‚å­˜åœ¨ä¸Šé¢æ‰€æåˆ°çš„ä¸‰å€‹æª”æ¡ˆï¼Œæ‰èƒ½å¤ é †åˆ©è®€å–ã€‚\nDotSpatial V.S. GDAL: why GDAL? å‰è¼©ç•™ä¸‹ä¾†çš„ç¨‹å¼ç¢¼ä¸­ï¼Œä½¿ç”¨çš„éƒ½æ˜¯ DotSpatial é€™å€‹å¥—ä»¶ï¼Œæ‰€ä»¥ä¸€é–‹å§‹æˆ‘ä¹Ÿè·Ÿè‘—ä½¿ç”¨ã€‚ä½†å¾Œä¾†åœ¨åŸ·è¡Œç¨‹å¼çš„éç¨‹ä¸­ï¼Œæ™‚ä¸æ™‚æœƒé‡åˆ°ä¸€å€‹å¥‡æ€ªçš„å•é¡Œï¼šæŠŠç›¸åŒçš„ç¨‹å¼ç¢¼éƒ¨ç½²åœ¨ä¸‰å€‹ä¸åŒçš„ç’°å¢ƒä¸Šï¼Œç”¢ç”Ÿå‡ºä¾†çš„ Shapefile Feature å…§å®¹æœƒä¸ä¸€æ¨£ã€‚\nlocal ç«¯æœ‰å®Œæ•´çš„ 100 å¤šå€‹ï¼Œç§»åˆ°æ­£å¼ç’°å¢ƒä¸Šå»åªå‰©ä¸‹ä¸åˆ° 10 å€‹ ğŸ˜¢ ç”±æ–¼ä¸€ç›´ç ”ç©¶ä¸å‡ºå€‹æ‰€ä»¥ç„¶ï¼Œæ±ºå®šæœæ–·æ¨æ£„é€™å€‹å¥—ä»¶ï¼Œæ”¹ç”¨ä»Šå¤©è¦ä»‹ç´¹çš„ GDALã€‚\nå®‰è£å¥—ä»¶ .NET Framework å’Œ .NET æ‰€å®‰è£çš„ Nuget å¥—ä»¶ä¸å¤ªç›¸åŒï¼š\nNuget Notes .NET Framework Gdal \u0026amp; Gdal.Native ä¿ç•™ .cs çš„ Configuration æª”æ¡ˆå°±å¥½ï¼Œç§»é™¤å¦ä¸€å€‹ï¼Œä¸¦ä¿®æ”¹ namespace .NET Gdal.Core è®€å– Shapefile æª”æ¡ˆ æˆ‘åˆ©ç”¨ QGIS è£½ä½œäº†ä¸€å€‹ç°¡å–®çš„ Shapefile æª”æ¡ˆï¼Œåªæœ‰ä¸€å€‹ Featureï¼ŒåŒ…å«çš„å…§å®¹å¦‚ä¸‹ï¼š\nè®€å–çš„ç¨‹å¼ç¢¼å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 // è¨»å†Š GDAL Gdal.AllRegister(); Ogr.RegisterAll(); // é–‹å•Ÿ SHP æª”æ¡ˆï¼ˆ0 - è®€å–ã€1 - è®€å¯«ï¼‰ var source = Ogr.Open(\u0026#34;files/simple/test.shp\u0026#34;, (int)EnumShapefileOpen.ReadOnly); var layerCount = source.GetLayerCount(); for (var i = 0; i \u0026lt; layerCount; i++) { // è®€å–åœ–å±¤ Layer è³‡è¨Š var layer = source.GetLayerByIndex(i); var fieldCount = layer.GetLayerDefn().GetFieldCount(); for (var j = 0; j \u0026lt; fieldCount; j++) { var field = layer.GetLayerDefn().GetFieldDefn(j); var fieldName = field.GetName(); Console.WriteLine($\u0026#34;æ¬„ä½{j + 1}. {fieldName}\u0026#34;); } // è®€å–è¦ç´  Feature Feature feature; while ((feature = layer.GetNextFeature()) != null) { var id = feature.GetFieldAsInteger(0); Console.WriteLine($\u0026#34;å…§å®¹1. Id: {id}\u0026#34;); var name = feature.GetFieldAsString(1); Console.WriteLine($\u0026#34;å…§å®¹2. åœŸåœ°åç¨±: {name}\u0026#34;); var area = feature.GetFieldAsInteger64(2); Console.WriteLine($\u0026#34;å…§å®¹3. åœŸåœ°é¢ç©: {area}\u0026#34;); // è½‰æ›æˆ WKT çš„å€¼ var geometry = feature.GetGeometryRef(); geometry.ExportToWkt(out var wkt); Console.WriteLine($\u0026#34;- WKT: {wkt}\u0026#34;); } } public enum EnumShapefileOpen { ReadOnly } åŸ·è¡Œçµæœå¦‚ä¸‹ï¼š\nå¾åŸ·è¡Œçµæœä¸­å¯ä»¥ç™¼ç¾ï¼Œæ˜æ˜æˆ‘åœ¨ QGIS ç·¨è¼¯çš„æ™‚å€™å€¼æ˜¯ä¸­æ–‡ï¼Œåˆ°äº† C# é€™é‚Šå»è®Šæˆäº†äº‚ç¢¼ã€‚åŒæ™‚ï¼Œæ¬„ä½çš„åç¨±æ˜æ˜ä¹Ÿæ˜¯ä¸­æ–‡ï¼Œå»å¯ä»¥æ­£å¸¸åœ°é¡¯ç¤ºã€‚WHYï¼Ÿ\nè®“æˆ‘å€‘åœ¨ä¸‹å›åˆ†æ›‰ã€‚\nåƒè€ƒæ–‡ç« \nC#ä¸ç”¨ArcEngineï¼Œç”ŸæˆShpæ–‡ä»¶(ä¸€) â€” â€” â€” â€” -shapefileæ•°æ®è¯´æ˜ ","date":"2022-07-24T23:40:41+08:00","permalink":"https://anthea-wu.github.io/post/gdal-shapefile-1/","title":"GDAL æ“ä½œ ShapeFile (1)"},{"content":"ä¸€èˆ¬åœ¨ IIS ä¸Šå•Ÿç”¨ https çš„æ­¥é©Ÿå¾ˆç°¡å–®ï¼šå…ˆåŒ¯å‡ºæ†‘è­‰è¦æ±‚ï¼Œæ¥è‘—åœ¨æ”¶åˆ°æ†‘è­‰ä¹‹å¾Œå®Œæˆæ†‘è­‰è¦æ±‚ï¼Œåœ¨ç«™å°ä¸Šè¨­å®šæ–°çš„ç¹«çµï¼Œå°‡ 443 æŒ‡å®šåˆ°ç”³è«‹çš„æ†‘è­‰ä¸Šçš„åŸŸåå³å¯ã€‚\nä½†æ˜¯ï¼Œåˆ©ç”¨ IIS å»å‘ä¸­è¯é›»ä¿¡æ‰€ç”³è«‹åˆ°çš„æ†‘è­‰æ ¼å¼ç‚º .cerï¼Œåœ¨ Nginx çš„å®˜ç¶²ä¸­ï¼Œä½¿ç”¨çš„å»æ˜¯ .crt æ ¼å¼ï¼Œä¸¦ä¸”é‚„å¤šäº†ä¸€å€‹ä¸€èˆ¬æµç¨‹ä¸­ä¸æœƒçœ‹åˆ°çš„ .keyã€‚ç¶²è·¯ä¸Šçš„æ•™å­¸å¤§å¤šæ˜¯ç›´æ¥ä½¿ç”¨ openssl å»ç”Ÿç”¢æ†‘è­‰ï¼Œç”±æ–¼é€™å€‹æ¡ˆå­æ˜¯å·²ç¶“æœ‰ç”³è«‹å¥½çš„æ†‘è­‰ï¼Œæ‰€ä»¥æˆ‘å€‘è¦é€éä¸€äº›æ–¹æ³•ä¾†æŠŠç”³è«‹åˆ°çš„æ†‘è­‰è½‰æˆ Nginx å¯ä»¥ä½¿ç”¨çš„æ ¼å¼ã€‚\nåœ¨ Nginx ä¸­ä½¿ç”¨ cer ä¾†è¨­å®š https å¯ä»¥åœ¨ä¸Šé¢é‚£å¼µåœ–ç‰‡ä¸­è§€å¯Ÿåˆ°ï¼Œæœ‰å…©å€‹åœ°æ–¹çš„å€¼æ˜¯ç²—é«”çš„é»‘å­—ï¼šssl_certificate å’Œ ssl_certificate_keyï¼Œé€™å…©å€‹éƒ¨åˆ†è¦æ”¾çš„å°±æ˜¯æ†‘è­‰çš„æª”æ¡ˆå’Œæ†‘è­‰çš„ç§å¯†é‡‘é‘°ã€‚è€Œåœ¨é€™è£¡æœƒæœ‰å…©å€‹å•é¡Œï¼š\nå¦‚æœæ˜¯åˆ©ç”¨ IIS å»ç”¢ç”Ÿæ†‘è­‰è¦æ±‚æ‰€ç”³è«‹åˆ°çš„æ†‘è­‰ï¼Œæœƒæ²’æœ‰è¾¦æ³•ç›´æ¥å¾—åˆ°ç§å¯†é‡‘é‘°ï¼Œå› ç‚ºä»–æœƒæ˜¯åŠ å¯†éå¾Œçš„å…§å®¹ï¼Œè€Œ Nginx è¦æ±‚æ˜¯ä¸èƒ½åŠ å¯†çš„æª”æ¡ˆã€‚ ç”³è«‹æ‰€å¾—åˆ°çš„æ†‘è­‰ .cer æ²’æœ‰è¾¦æ³•ç›´æ¥ä½¿ç”¨åœ¨ Nginx ä¸Šã€‚ åœ¨çœ‹é€™äº›å•é¡Œä¹‹å‰ï¼Œè¦å…ˆäº†è§£ä¸€ä¸‹é€™å¹¾å€‹æª”æ¡ˆçš„ç”¨é€”å’Œå·®åˆ¥ï¼š\nåç¨± ç”¨é€” èªªæ˜ crt æ†‘è­‰è­‰æ›¸ Lunix ç³»çµ±ä¸Šçš„æª”æ¡ˆæ ¼å¼ cer æ†‘è­‰è­‰æ›¸ Windows ç³»çµ±ä¸Šçš„æª”æ¡ˆæ ¼å¼ key é‡‘é‘° å­˜æ”¾å…¬é‘°æˆ–ç§é‘° pfx æ†‘è­‰è­‰æ›¸åŠç§é‘° Windows ç³»çµ±ä¸ŠæœƒæŠŠ crt å’Œç§é‘° key æ”¾åœ¨åŒä¸€å€‹æª”æ¡ˆå…§ï¼Œéœ€è¦æœ‰å¯†ç¢¼æ‰èƒ½æå– äº†è§£äº†é€™å¹¾ç¨®ä¸åŒçš„åè©ä¹‹å¾Œï¼Œæ¥ä¸‹ä¾†å°±æ˜¯è¦æŠŠæˆ‘å€‘æ‰‹ä¸Šæœ‰çš„ cer æ†‘è­‰æª”æ¡ˆè½‰æ›æˆ Nginx å¯ä»¥æ¥å—çš„æ ¼å¼ã€‚\n1. åŒ¯å‡º pfx æª”æ¡ˆ ç¬¬ä¸€å€‹æ­¥é©Ÿï¼Œæ˜¯è¦è—‰ç”± cer ä¾†å–å¾—åŒ…å«æ†‘è­‰è­‰æ›¸å’Œç§é‘°çš„ pfx æª”æ¡ˆã€‚\nWindows + R é–‹å•Ÿ åŸ·è¡Œï¼Œè¼¸å…¥ mmc æª”æ¡ˆ \u0026gt; æ–°å¢æˆ–ç§»é™¤åµŒå…¥å¼ç®¡ç†å–®å…ƒï¼Œæ‹‰åˆ°æœ€åº•ä¸‹æ‰¾åˆ° æ†‘è­‰ï¼Œé»é¸å¾Œé»æ“Šä¸­é–“çš„æ–°å¢ï¼Œæœƒè·³å‡ºå¦å¤–ä¸€å€‹è¦–çª—ï¼Œé¸æ“‡ é›»è…¦å¸³æˆ¶ \u0026gt; æœ¬æ©Ÿé›»è…¦ï¼ŒæŒ‰ä¸‹å®Œæˆå¾Œè¦–çª—æœƒå›åˆ° åµŒå…¥å¼ç®¡ç†å–®å…ƒ é€™ä¸€å±¤ï¼Œç¢ºå®šæ†‘è­‰æœ‰è¢«ç§»å‹•åˆ°å³é‚Šçš„è¦–çª—å¾Œå°±å¯ä»¥æŒ‰ä¸‹ç¢ºå®šã€‚ åœ¨æ†‘è­‰çš„ç›®éŒ„åº•ä¸‹é¸æ“‡ å€‹äºº\u0026gt;æ†‘è­‰ï¼Œå¦‚æœæœ‰å…ˆåœ¨ IIS å®Œæˆæ†‘è­‰è¦æ±‚çš„è©±å°±å¯ä»¥çœ‹åˆ°åŸæœ¬åŒ¯å…¥çš„æ†‘è­‰ï¼Œæ²’æœ‰çš„è©±è«‹å…ˆåŒ¯å…¥ã€‚æ‰¾åˆ°è¦åŒ¯å‡º pfx æª”æ¡ˆçš„æ†‘è­‰å°ä»–é»é¸ å³éµ \u0026gt; æ‰€æœ‰å·¥ä½œ \u0026gt; åŒ¯å‡ºï¼Œé¸æ“‡ æ˜¯ï¼ŒåŒ¯å‡ºç§å¯†é‡‘é‘°ï¼Œé»é¸å…©æ¬¡ä¸‹ä¸€æ­¥é€²å…¥ å®‰å…¨æ€§ çš„é é¢ï¼Œè¼¸å…¥è¦å­˜å– pfx æ™‚çš„å¯†ç¢¼ã€‚ä¸‹ä¸€æ­¥è¼¸å…¥æª”åå¾ŒæŒ‰ä¸‹å„²å­˜å°±å¯ä»¥å¾—åˆ° pfx æª”æ¡ˆäº†ã€‚ 2. è½‰æˆ crt æª”æ¡ˆ æœ‰äº† pfx çš„ä¸‹ä¸€æ­¥å°±æ˜¯è¦è½‰æ›æˆ crt å’Œ keyã€‚è½‰æ›çš„æ–¹æ³•å¾ˆç°¡å–®ï¼Œä½¿ç”¨ opensslï¼Œè¼¸å…¥ä¸‹é¢çš„æŒ‡ä»¤ï¼Œå°±å¯ä»¥å¾—åˆ°é€™å…©å€‹æª”æ¡ˆäº†ï¼š\n1 2 3 4 5 # è¼¸å‡º crt openssl pkcs12 -in server.pfx -clcerts -nokeys -out server.crt # è¼¸å‡º key openssl pkcs12 -in server.pfx -nocerts -nodes -out server.rsa 3. ä¿®æ”¹ nginx.conf ç”¢å‡ºå…©å€‹æª”æ¡ˆä¹‹å¾Œå°±å¯ä»¥é€²å…¥ nginx.conf çš„ä¿®æ”¹äº†ã€‚ä¿®æ”¹å¥½è¨˜å¾—è¦ nginx -s reloadï¼Œé˜²ç«ç‰† 443 port çš„éƒ¨åˆ†ä¹Ÿè¦è¨˜å¾—é–‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 events { worker_connections 4096; } http { upstream www.abc.com { server localhost:8082; server localhost:8083; } server { # å› ç‚ºæ˜¯æ­£å¼çš„ç’°å¢ƒï¼Œé˜²ç«ç‰†ä¹Ÿéœ€è¦ç”³è«‹ï¼Œæ‰€ä»¥æ”¹æˆç›£è½åŸæœ¬ IIS ç›£è½çš„ 80 port listen 80; server_name www.abc.com; location / { # å°‡ http è½‰å°åˆ° https return 301 https://$host$request_uri; } } server { listen 443 ssl; server_name www.abc.com; ssl_certificate server.crt; ssl_certificate_key server.rsa; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_ciphers HIGH:!aNULL:!MD5; location / { proxy_pass http://guideapp.npm.gov.tw; # ä»¥ä¸‹ç‚º proxy çš„è©³ç´°è¨­ç½®ï¼Œå¯ä»¥åƒè€ƒä¸‹åˆ—ç¶²ç«™çš„èªªæ˜ # https://www.cnblogs.com/kevingrace/p/8269955.html proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection keep-alive; proxy_set_header Host $host; proxy_cache_bypass $http_upgrade; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } } } åƒè€ƒè³‡æ–™\nNginx ä¸­ä½¿ç”¨ PFX æ ¼å¼çš„ SSL è¯ä¹¦ crtã€pemã€pfxã€cerã€key ä½œç”¨åŠå€åˆ¥ ","date":"2022-07-02T23:24:03+08:00","permalink":"https://anthea-wu.github.io/post/nginx-web-setup-4/","title":"Nginx å¾å…¥é–€é–‹å§‹çš„ç¶²ç«™æ¶è¨­ (4)"},{"content":"ä¸Šä¸€ç¯‡æ–‡ç«  ä¸­æˆ‘å€‘ç”¨æœ€ç°¡å–®çš„è¨­å®šå»ºç«‹èµ·ä¸€å€‹éœæ…‹æœå‹™äº†ï¼Œæ¥ä¸‹ä¾†è¦æåˆ°çš„æ˜¯ Nginx æœ€å»£ç‚ºäººçŸ¥çš„å…¶ä¸­ä¸€ç¨®åŠŸèƒ½ï¼ï¼ä»£ç†ä¼ºæœå™¨ï¼ˆProxy Serverï¼‰ã€‚\nProxy Server ä»£ç†ä¼ºæœå™¨ æœ‰ä¸€é™£å­å‹Ÿè³‡å¹³å°å¾ˆæµè¡Œï¼Œç•¶ä½ æœ‰æƒ³æ³•ä½†æ˜¯æ²’æœ‰è³‡é‡‘çš„æ™‚å€™ï¼Œä½ å¯ä»¥é€éé€™äº›å¹³å°æŠŠä½ çš„è¨ˆåŠƒæ”¾ä¸Šå»ï¼Œå¸å¼•ä¸€èˆ¬æ°‘çœ¾æŠ•å…¥è³‡é‡‘ï¼Œæ¥è‘—æ‹¿é€™äº›éŒ¢å»å¯¦éš›ç”Ÿç”¢ä½ çš„ç”¢å“ï¼Œä¸¦çµ¦ç•¶åˆæä¾›ä½ è³‡é‡‘çš„æ°‘çœ¾ä¸€äº›å›é¥‹ã€‚åœ¨é€™å€‹éç¨‹ä¸­ï¼Œå‹Ÿè³‡å¹³å°æ‰€æ‰®æ¼”çš„è§’è‰²å°±æ˜¯ä»£ç†ï¼šä½ åªèƒ½çœ‹åˆ°è³‡é‡‘æä¾›è€…çš„æä¾›çš„å¯„ä»¶è³‡è¨Šï¼Œç”šè‡³å®Œå…¨ä¸çŸ¥é“ä»–å€‘çš„èº«åˆ†ï¼Œä½†ä½ æœƒè² è²¬æŠŠä½ çš„ç”¢å“æˆ–å›é¥‹é€éå¹³å°æä¾›å‡ºå»ã€‚\nä»¥ç¶²è·¯ä¾†èªªï¼ŒClientï¼ˆä¸€èˆ¬æ°‘çœ¾ï¼‰é€éä»£ç†ä¼ºæœå™¨ï¼ˆå‹Ÿè³‡å¹³å°ï¼‰ç™¼é€è«‹æ±‚çµ¦ Serverï¼ˆä½ ï¼‰ï¼ŒServer åŸºæœ¬ä¸Šä¸æœƒæœ‰ Client çš„è³‡æ–™ï¼Œè€Œé€™å°±æ˜¯ Proxy çš„å¥½è™•ä¹‹ä¸€ï¼šéš±è— Client çš„çœŸå¯¦èº«åˆ†ã€‚\nå…¶ä»–çš„å¥½è™•é‚„æœ‰å¾ˆå¤šï¼Œä½†ä»Šå¤©æˆ‘åªæƒ³çœ‹é€™æ¬¡å®¢æˆ¶æœ€ä¸»è¦çš„ç›®çš„ï¼šLoad Balanceï¼ˆè² è¼‰å¹³è¡¡ï¼‰ã€‚\nLoad Balance è² è¼‰å¹³è¡¡ Load Balance çš„ä¸»è¦ç›®çš„åœ¨æ–¼åˆ†æ•£ä¼ºæœå™¨ç«¯çš„å£“åŠ›ï¼Œè®“ä¼ºæœå™¨çš„å›æ‡‰é€Ÿåº¦å’Œå…¶ä»–æ•ˆèƒ½å¯ä»¥å¾—åˆ°æå‡ï¼Œä½¿ç”¨è€…èƒ½æ“æœ‰æ›´å¥½çš„é«”é©—ã€‚è€Œè¦åšåˆ°é€™å€‹ç¨‹åº¦ä¸€èˆ¬ä¾†èªªéƒ½æœƒéœ€è¦ä¾è³´å‰›å‰›æ‰€æåˆ°çš„ proxy åšç‚ºä¸­ç¹¼ç«™ï¼Œå»åˆ¤æ–·ç¾åœ¨æ¥æ”¶åˆ°çš„é€™å€‹ request è¦è¢«åˆ†é…åˆ°å“ªä¸€å° server ä¸Šã€‚\nNginx è¨­å®š ç¨å¾®äº†è§£ Proxy Server å’Œ Load Balance çš„ç”¨é€”ä¹‹å¾Œï¼Œæ¥ä¸‹ä¾†é–‹å§‹è©¦è‘—ç”¨ Nginx ä¾†é€²è¡Œè¨­å®šå§ã€‚\nProxy é¦–å…ˆè¨­å®šå¥½ nginx.conf ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 events { worker_connections 1024; } http { server { listen 8081; server_name localhost; # ä»¥ \u0026#39;/\u0026#39; é–‹é ­çš„ url æœƒå‘ \u0026#39;/data/www\u0026#39; ç™¼é€è«‹æ±‚ location / { # è¨­å®šè¦å°å‘çš„è·¯å¾‘ # å¦‚æœ IIS ä¸Šæœ‰è¨­å®š 8082 port çš„ç«™å°å°±æœƒè¢«å°å‘é‚£å€‹ç«™å° proxy_pass http://localhost:8082; } } # IIS ä¸Šæ²’æœ‰çš„ç«™å°ï¼Œè¨­å®š 8082 port çš„å…§å®¹ server { listen 8082; server_name localhost; # ä»¥ \u0026#39;/\u0026#39; é–‹é ­çš„ url æœƒå‘ \u0026#39;/data/www2\u0026#39; ç™¼é€è«‹æ±‚ location / { root data/www2; } } } æ¥è‘—åˆ° /data/www2 åº•ä¸‹æ–°å¢ä¸€å€‹æ–°çš„ index.htmlï¼Œé€™æ™‚å€™ www å’Œ www2 çš„è³‡æ–™å¤¾å…§å„æœ‰ä¸€å€‹ index.htmlï¼Œä¸Šä¸€ç¯‡æ–‡ç« ä¸­æˆ‘å€‘æœƒçœ‹åˆ° www å…§çš„ index.htmlï¼Œé€™ä¸€æ¬¡çš„è¨­å®šé æœŸæœƒå‡ºç¾çš„æ‡‰è©²æ˜¯ www2 å…§çš„ index.htmlã€‚\nå„²å­˜ä¿®æ”¹å¥½çš„ config ä¹‹å¾Œï¼Œnginx -s reload é‡æ–°è¼‰å…¥æª”æ¡ˆï¼Œåœ¨ç€è¦½å™¨ä¸­è¼¸å…¥ http://localhost:8081 æ‡‰è©²å°±å¯ä»¥çœ‹åˆ° www2 ä¸­ index.html çš„å…§å®¹å›‰ã€‚\nLoad Balance è¦åœ¨ Nginx ä¸­ä½¿ç”¨ Load Balance éœ€è¦åœ¨ http ä¸­åŠ å…¥ upstream é€™çµ„è¨­å®šï¼ŒåŠ å¥½ä¹‹å¾Œä½ çš„ nginx.conf æ‡‰è©²æœƒé•·é€™æ¨£ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 events { worker_connections 1024; } http { # \u0026#39;localhost\u0026#39; æ˜¯é€™çµ„ upstream çš„åç¨± upstream localhost { # åˆ©ç”¨ \u0026#39;weight\u0026#39; ä¾†è¨­å®šæ¬Šé‡ server localhost:8082 weight=1; server localhost:8083 weight=2; } server { listen 8081; server_name localhost; location / { # é€™è£¡è¦æ”¹æˆ upstream çš„åç¨± proxy_pass http://localhost; } } server { listen 8082; server_name localhost; location / { # åœ¨ nginx.exe åŒä¸€å±¤çš„è³‡æ–™å¤¾ data è£¡é¢æ–°å¢ä¸€å€‹è³‡æ–™å¤¾ www å’Œ index.html root data/www; } } server { listen 8083; server_name localhost; location / { # åœ¨ nginx.exe åŒä¸€å±¤çš„è³‡æ–™å¤¾ data è£¡é¢æ–°å¢ä¸€å€‹è³‡æ–™å¤¾ www2 å’Œ index.html root data/www2; } } } è¨­å®šå¥½ä¹‹å¾Œ nginx -s reloadï¼Œç€è¦½å™¨æ‰“é–‹ http://localhost:8081ï¼ŒæŒçºŒé‡æ–°æ•´ç†ï¼Œå°±å¯ä»¥çœ‹åˆ°äº¤æ›¿å‡ºç¾çš„å…©å€‹ index.html å›‰~\nåƒè€ƒè³‡æ–™ï¼š\nåå‘ä»£ç†èˆ‡æ­£å‘ä»£ç† ä¿„ç¾…æ–¯ä¸æ„§æ˜¯æˆ°é¬¥æ°‘æ—ï¼šnginx ","date":"2022-06-23T23:15:50+08:00","permalink":"https://anthea-wu.github.io/post/nginx-web-setup-3/","title":"Nginx å¾å…¥é–€é–‹å§‹çš„ç¶²ç«™æ¶è¨­ (3)"},{"content":"åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æˆ‘å€‘ç°¡å–®èªè­˜äº† nginx çš„æ“ä½œï¼Œæ¥ä¸‹ä¾†æˆ‘å€‘è¦é€éé‚£äº›æ“ä½œä¾†å»ºç«‹ä¸€å€‹éœæ…‹æœå‹™ã€‚\n1. æº–å‚™è³‡æ–™ å‡è¨­æˆ‘å€‘çš„ nginx.exe ä½æ–¼ nginx åº•ä¸‹ï¼Œæ¥è‘—æˆ‘å€‘åœ¨é€™è£¡æ–°å¢ä¸€å€‹è³‡æ–™å¤¾ dataï¼Œä¸¦åœ¨ data è£¡é¢å†æ–°å¢å…©å€‹è³‡æ–™å¤¾ï¼Œåˆ†åˆ¥æ˜¯ www å’Œ imagesï¼Œå°‡ index.html æ”¾å…¥ www è³‡æ–™å¤¾ä¸­ï¼Œå°‡ä»»æ„çš„åœ–ç‰‡æ”¾åˆ° images è³‡æ–™å¤¾å…§ï¼Œé€™æ™‚å€™ä½ çš„è³‡æ–™å¤¾çµæ§‹æœƒåƒé€™æ¨£ï¼š\n1 2 3 4 5 6 7 8 9 nginx |- nginx.exe |- conf |- data | |- www | | |- index.html | |- images | | |- test.jpg |- ... 2. ä¿®æ”¹ nginx.conf æ¥è‘—é–‹å•Ÿä½ çš„ nginx.confï¼Œä¸¦ç”¨ä¸‹é¢çš„å…§å®¹å–ä»£æ‰åŸæœ¬çš„è¨­å®šï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 events { worker_connections 1024; } http { server { # å¦‚æœé›»è…¦ä¸Šæœ‰è£ IISï¼Œé è¨­æœƒå ç”¨æ‰ 80 port # ç•¶é€™è£¡æ²’æœ‰æ”¹æˆå…¶ä»– port è™Ÿï¼Œå°±ç®—é‹è¡Œäº† nginx ä¹Ÿæœƒè¢«å¸¶åˆ° IIS çš„ç•«é¢å» listen 8081; server_name localhost; # ä»¥ \u0026#39;/\u0026#39; é–‹é ­çš„ url æœƒå‘ \u0026#39;/data/www\u0026#39; ç™¼é€è«‹æ±‚ location / { # å®˜æ–¹æ–‡ä»¶ä¸Šæ˜¯å¯« \u0026#39;/data/www\u0026#39;ï¼Œä½†æ¸¬è©¦éå¾Œç„¡æ³•åŸ·è¡Œ root data/www; } # ä»¥ \u0026#39;/images/\u0026#39; é–‹é ­çš„ url æœƒå‘ \u0026#39;/data\u0026#39; ç™¼é€è«‹æ±‚ location /images/ { root data; } } } åœ¨è¨­å®š location çš„æ™‚å€™ï¼Œå¦‚æœä¸€å€‹ url å¦‚æœæœ‰å¤šå€‹ç›¸ç¬¦çš„å€å¡Šï¼Œnginx æœƒé¸æ“‡å…·æœ‰æœ€é•·å‰ç¶´çš„å€å¡Šä¾†ç™¼é€è«‹æ±‚ã€‚ä»¥ä¸Šé¢çš„ä¾‹å­ä¾†èªªï¼Œç¬¬ä¸€å€‹å€å¡Šçš„å‰ç¶´æ˜¯ /ï¼Œé•·åº¦ç‚º 1ï¼Œå› æ­¤ç•¶æˆ‘è¼¸å…¥ç¶²å€ /books æ™‚ï¼Œnginx æœƒå¹«æˆ‘å¾é•·åº¦æ›´é•·çš„ /images é–‹å§‹æ¯”å°ã€‚é€™æ™‚å€™å› ç‚ºæ²’æœ‰å…¶ä»–ç›¸ç¬¦çš„ç›®çš„åœ°äº†ï¼Œæ‰€ä»¥ä»–æœƒèµ°é€²æœ€çŸ­çš„ / è£¡ã€‚\n3. reload nginx.conf å°‡ nginx.conf å„²å­˜ä¹‹å¾Œï¼Œé–‹å•Ÿ cmd å°‡ç›®éŒ„åˆ‡æ›åˆ° nginx çš„è³‡æ–™å¤¾åº•ä¸‹ï¼Œå¦‚æœå·²ç¶“å•Ÿå‹•é nginxï¼ŒåŸ·è¡Œ nginx -s reload ä¾†é‡æ–°è¼‰å…¥æ”¹å¯«å¥½çš„ nginx.confï¼›å¦‚æœé‚„æ²’æœ‰ï¼Œè¼¸å…¥ start nginx ä¾†å•Ÿå‹• nginxã€‚\næ²’æœ‰å‡ºç¾ä»»ä½•éŒ¯èª¤çš„è©±ï¼Œå°±å¯ä»¥æ‰“é–‹ç€è¦½å™¨ï¼Œè¼¸å…¥ localhost:8081 å°±å¯ä»¥çœ‹åˆ°æˆ‘å€‘å‰›å‰›æ–°å¢åœ¨ /data/www åº•ä¸‹çš„ index.html äº†ã€‚\nåƒè€ƒè³‡æ–™\nBeginnerâ€™s Guide ","date":"2022-06-17T22:53:49+08:00","permalink":"https://anthea-wu.github.io/post/nginx-web-setup-2/","title":"Nginx å¾å…¥é–€é–‹å§‹çš„ç¶²ç«™æ¶è¨­ (2)"},{"content":"æœ€è¿‘æœ‰å€‹æ¡ˆå­ï¼Œå®¢æˆ¶è¦ºå¾—æˆ‘å€‘ç¬¬ä¸€æ¬¡äº¤ä¸Šå»çš„å£“åŠ›æ¸¬è©¦çµæœå¤ªç‹¼ç‹½ï¼Œè¦æˆ‘å€‘æƒ³è¾¦æ³•æŠŠæ•¸å­—åšå¾—æ›´å¥½ï¼Œæ–¼æ˜¯æˆ‘å€‘å˜—è©¦äº† windows å…§å»ºçš„ Network Load Balanceï¼ˆNLBï¼‰ä¾†é€²è¡Œè¨­å®šï¼Œç¤™æ–¼ç¶²è·¯ç®¡ç†çš„åŸºç¤çŸ¥è­˜ä¸è¶³ï¼Œé‡åˆ°äº†éå¸¸å¤šçš„é˜»ç¤™ QQ\næœ€å¾Œé€é Nginx æˆåŠŸåšåˆ°äº† Load Balanceï¼Œé€™å€‹ç³»åˆ—çš„æ–‡ç« å°±æ˜¯ä¾†ç´€éŒ„é †ä¾¿è¤‡ç¿’å­¸ç¿’åˆ°çš„å…§å®¹ã€‚\nBeginnerâ€™s Guide å¾ Nginx çš„å®˜ç¶²ä¸Šä¸‹è¼‰ä¸‹ä¾†çš„æª”æ¡ˆå…§å®¹å…¶å¯¦å¾ˆç°¡å–®ï¼Œåªæœ‰ä¸€å€‹ exe åŸ·è¡Œæª”å’Œä¸€äº›è³‡æ–™å¤¾ã€‚\nNginx çš„é‹ä½œæ–¹å¼ä¸»è¦æ˜¯é  nginx.conf ä¾†æ±ºå®šçš„ï¼Œé€™å€‹æª”æ¡ˆé€šå¸¸æœƒåœ¨ /usr/local/nginx/conf /etc/nginx /usr/local/etc/nginx é€™å¹¾å€‹ç›®éŒ„åº•ä¸‹ã€‚\nå•Ÿå‹• Nginx é›™æ“Šä¾†åŸ·è¡Œ nginx.exe é€é cmd åˆ‡æ›åˆ° nginx çš„è³‡æ–™å¤¾åº•ä¸‹ï¼ŒåŸ·è¡Œ start nginx å° Nginx é€²è¡Œæ“ä½œ nginx è¢«åŸ·è¡Œèµ·ä¾†å¾Œå°±éœ€è¦ä»¥ nginx -s \u0026lt;options\u0026gt; çš„æ–¹å¼ä¾†æ§åˆ¶ï¼š\nå…¶ä¸­ nginx -s stop å’Œ nginx -s quit çš„å·®åˆ¥åœ¨æ–¼ï¼š\nquit - åœæ­¢æ¥æ”¶ requestï¼Œç­‰åˆ°æ‰‹ä¸Šé€™å€‹ request è™•ç†å®Œä¹‹å¾Œï¼Œæ‰æœƒçµæŸç›®å‰çš„æœå‹™ stop - ç«‹åˆ»çµæŸæœå‹™ å¦å¤–ï¼Œ nginx -s quit åªèƒ½ç”±é–‹å•Ÿ nginx çš„ä½¿ç”¨è€…ï¼ˆå¸³è™Ÿï¼‰åŸ·è¡Œã€‚\né™¤äº† nginx -s stop ä¹‹å¤–ï¼Œæœ€å¸¸æœƒç”¨åˆ°çš„æ‡‰è©²æ˜¯ nginx -s reloadã€‚\nå¦‚æœ nginx.conf æœ‰é€²è¡Œä¿®æ”¹çš„è©±ï¼ŒåŸ·è¡Œ reload å¾Œä¸»ç¨‹å¼æ‰æœƒåƒåˆ°é€™å€‹è¨­å®šçš„æ›´æ”¹ã€‚å¦‚æœä¸»ç¨‹å¼è¨­å®šæˆåŠŸï¼Œæœƒé€šçŸ¥å…¶ä»–èˆŠæœ‰çš„ç¨‹å¼ï¼Œè®“ä»–å€‘åœæ­¢æ¥æ”¶æ–°çš„ requestï¼Œå°‡æ‰‹ä¸Šçš„ request è™•ç†å®Œä¹‹å¾ŒçµæŸæœå‹™ï¼Œç”¨æ–°çš„è¨­å®šé–‹å•Ÿä¸€å€‹æ–°çš„ç¨‹å¼ã€‚å¦‚æœä¸»ç¨‹å¼è¨­å®šå¤±æ•—çš„è©±ï¼ŒæœƒæŠŠè¨­å®š rollback æˆèˆŠçš„è¨­å®šä¸¦ç¹¼çºŒåŸ·è¡Œã€‚\nconfig æª”æ¡ˆçš„åè© åœ¨ä¿®æ”¹ nginx.conf ä¹‹å‰ï¼Œå…ˆä¾†èªè­˜ä¸€ä¸‹ config æª”æ¡ˆè£é¢åŸºæœ¬çš„çµ„æˆå…ƒç´ ï¼š\nsimple directives - åŒ…å«æŒ‡ä»¤åç¨±å’Œåƒæ•¸ï¼Œå…©è€…ä¹‹é–“ç”¨åŠå½¢ç©ºç™½ä¾†å€éš”ï¼Œä¸¦ä¸”ä»¥åŠå½¢åˆ†è™Ÿ ; ä½œç‚ºçµå°¾ block directive - çµæ§‹å’Œ simple directives ä¸€æ¨£ï¼Œä½†ä»–æœƒè¢«åŠå½¢å¤§æ‹¬è™Ÿ {} åŒ…èµ·ä¾† context - ä¸€å€‹ block directive è£¡é¢æœ‰å…¶ä»–çš„ directiveï¼Œä¾‹å¦‚ events http server location éƒ½æ˜¯å±¬æ–¼ context ","date":"2022-06-17T22:41:56+08:00","permalink":"https://anthea-wu.github.io/post/nginx-web-setup-1/","title":"Nginx å¾å…¥é–€é–‹å§‹çš„ç¶²ç«™æ¶è¨­ (1)"},{"content":"ä»Šå¤©çš„é‡é»æ˜¯åœ¨æ–¼ç•¶æˆ‘ä½¿ç”¨äº†åŒä¸€å€‹ Interface çš„æ™‚å€™ï¼Œè¦å¦‚ä½•è¨»å†Šä¸¦ä¸”åˆ†åˆ¥å–å¾—å¤šç¨®å¯¦ä½œçš„éƒ¨åˆ†ï¼Œå› æ­¤ä¸æœƒè‘—å¢¨åœ¨ Interface çš„åŸç†å’Œ DI çš„ä»‹ç´¹ã€‚\n.NET å’Œ Web API å‡è¨­ä»Šå¤©æœ‰å…©ç¨®å‚³é€è¨Šæ¯çš„æ–¹å¼ï¼Œä¸€ç¨®æ˜¯é€é slackï¼Œä¸€ç¨®æ˜¯é€é gmailï¼Œåœ¨åŒä¸€å€‹æƒ³è¦åŒæ™‚ä½¿ç”¨å…©ç¨®ç™¼é€æ–¹å¼çš„è©±ï¼Œå°±æœƒéœ€è¦ä½¿ç”¨åˆ° åŒä¸€å€‹ä»‹é¢è¨»å†Šå¤šå€‹å¯¦ä½œ çš„æ–¹æ³•ã€‚\né¦–å…ˆå»ºç«‹å…©å€‹ Serviceï¼Œä¸€å€‹æ˜¯ slack ä¸€å€‹æ˜¯ gmailï¼Œä¸¦æŠ½å‡º interfaceï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 public interface IMessageService { void Send(); } public class SlackService : IMessageService { public void Send() { Console.WriteLine(\u0026#34;Send By Slack\u0026#34;); } } public class GmailService : IMessageService { public void Send() { Console.WriteLine(\u0026#34;Send By Gmail\u0026#34;); } } æ¥è‘—æˆ‘å€‘åœ¨ Program.cs ä½¿ç”¨ delegate è¨»å†Š Interfaceï¼Œä¸¦ä¸”å‘ŠçŸ¥å°æ‡‰çš„ key è¼¸å…¥çš„æ™‚å€™è¦å›å‚³å“ªä¸€å€‹ Serviceï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 var builder = WebApplication.CreateBuilder(args); builder.Services.AddControllers(); builder.Services.AddSingleton\u0026lt;GmailService\u0026gt;(); builder.Services.AddSingleton\u0026lt;SlackService\u0026gt;(); builder.Services.AddSingleton\u0026lt;MessageServiceResolver\u0026gt;(serviceProvider =\u0026gt; key =\u0026gt; { return key switch { \u0026#34;gmail\u0026#34; =\u0026gt; serviceProvider.GetService\u0026lt;GmailService\u0026gt;(), \u0026#34;slack\u0026#34; =\u0026gt; serviceProvider.GetService\u0026lt;SlackService\u0026gt;(), }; }); var app = builder.Build(); app.MapControllers(); app.Run(); public delegate IMessageService MessageServiceResolver(string key); æœ€å¾Œï¼Œæˆ‘å€‘å»ºç«‹ä¸€å€‹ Controllerï¼Œåœ¨ Controller è£¡ä½¿ç”¨çš„æ™‚å€™åˆ†è¾¨è¨»å†Š Interfaceï¼Œä¸¦èª¿ç”¨ MessageServiceResolver ä¾†åˆ†åˆ¥å–å¾—å¯¦ä½œï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 using Microsoft.AspNetCore.Mvc; namespace WebApplication1.Controllers; [ApiController, Route(\u0026#34;api/[controller]\u0026#34;)] public class TestController : ControllerBase { private readonly IMessageService _gmail; private readonly IMessageService _slack; public TestController(MessageServiceResolver _service) { _slack = _service(\u0026#34;slack\u0026#34;); _gmail = _service(\u0026#34;gmail\u0026#34;); } public void Test() { _slack.Send(); _gmail.Send(); } } åƒè€ƒè³‡æ–™\nHow To Register Mmultiple Implementations Of The Same Interface In Asp Net Core ","date":"2022-05-25T22:29:58+08:00","permalink":"https://anthea-wu.github.io/post/%E5%90%8C%E4%B8%80%E5%80%8B%E4%BB%8B%E9%9D%A2%E5%A4%9A%E5%80%8B%E5%AF%A6%E4%BD%9C%E7%9A%84%E8%A8%BB%E5%86%8A/","title":"åŒä¸€å€‹ä»‹é¢å¤šå€‹å¯¦ä½œçš„è¨»å†Š"},{"content":"æœ€è¿‘é–‹å§‹æ€è€ƒæœ‰ä»€éº¼æ¨£çš„éœ€æ±‚å¯ä»¥ç•¶ä½œå°å°çš„ side project ç·´ç¿’ï¼Œå‰›å¥½æœ€è¿‘ç–«æƒ…çš„é—œä¿‚æ¯”è¼ƒå¤šäººè«‹å‡ï¼Œæˆ‘å°±æŠŠè…¦ç­‹å‹•åˆ°äº†è«‹å‡ç³»çµ±èº«ä¸Šã€‚åœ¨ç›®å‰çš„è«‹å‡æµç¨‹ä¸­ï¼Œæœ‰ä¸€å€‹éƒ¨åˆ†æ˜¯å¡«å¯« google è¡¨å–®ï¼Œé€å‡ºä¹‹å¾Œæœƒè‡ªå‹•æ–°å¢åˆ° google calendar ä¸Šï¼Œåªè¦æœ‰åŠ å…¥é€™å€‹æ—¥æ›†çš„äººéƒ½å¯ä»¥çœ‹åˆ°ã€‚æ‰€ä»¥æ±ºå®šä»¥é€™å€‹ç‚ºä¸»é¡Œï¼Œçˆ¬äº†ä¸€ä¸‹æ–‡ï¼Œé †ä¾¿ç´€éŒ„ä¸€ä¸‹ä½¿ç”¨ google calendar çš„éç¨‹ã€‚\nä½¿ç”¨å‰çš„æº–å‚™ Google API éƒ½æ˜¯é€é token ä¾†æ“ä½œçš„ï¼Œæ‰€ä»¥åœ¨æ­£å¼ä½¿ç”¨å‰éœ€è¦å…ˆç”³è«‹å¥½ tokenï¼Œä¸¦è·Ÿæˆ‘å€‘è‡ªå·±çš„ google calendar é€£å‹•ã€‚\nç”³è«‹ Token é€²å…¥ Google Cloud Platformï¼Œé è¨­æœƒå¹«ä½ å»ºç«‹ä¸€å€‹æ–°çš„å°ˆæ¡ˆï¼Œå¦‚æœè¦æ›´æ”¹å¯ä»¥é»é¸ç•«é¢ä¸Šæ–¹çš„ My First Projectã€‚ä¸éœ€è¦çš„è©±ï¼Œç›´æ¥é»é¸ç•«é¢å·¦å´çš„é¸å–®ï¼Œå¾ API èˆ‡æœå‹™ ä¸­é¸æ“‡ ç¨‹å¼åº«ã€‚ æœå°‹ Google Calendar API ä¸¦å•Ÿç”¨ï¼Œç­‰ loading è·‘å®Œå¾Œæœƒå‡ºç¾ ç®¡ç† çš„æŒ‰éˆ•ï¼Œæˆ–æ˜¯å¾é¸å–®çš„ API èˆ‡æœå‹™ ä¸­æ‰¾åˆ° æ†‘è­‰ï¼Œé»é¸ç•«é¢ä¸Šæ–¹çš„ æ–°å¢æ†‘è­‰ï¼Œé¸æ“‡ æœå‹™å¸³æˆ¶ çš„é¸é …ã€‚ è¼¸å…¥ æœå‹™å¸³æˆ¶è©³ç´°è³‡æ–™ å¾ŒæŒ‰ä¸‹é€å‡ºï¼Œæ¥è‘—æœƒå›åˆ°æ†‘è­‰é é¢ï¼Œæ‰¾åˆ°æœ€ä¸‹é¢çš„ æœå‹™å¸³æˆ¶ é‚£ä¸€åˆ—ï¼Œé»é¸å³å´çš„ç·¨è¼¯ï¼Œæ‰¾åˆ°ç•«é¢ä¸Šæ–¹çš„ é‡‘é‘°ï¼Œé»æ“Š æ–°å¢é‡‘é‘°ï¼Œé¸æ“‡ JSON çš„æ ¼å¼å¾ŒæŒ‰ä¸‹å»ºç«‹ï¼Œç€è¦½å™¨æœƒè‡ªå‹•ä¸‹è¼‰é€™ä»½æª”æ¡ˆï¼Œè«‹ä¸è¦éš¨æ„åˆªé™¤ï¼Œå¦‚æœéºå¤±äº†åªèƒ½é‡æ–°ç”¢ç”Ÿä¸€ä»½é‡‘é‘°ã€‚ å»ºç«‹ Calerdar é€²å…¥ Google Calendar å¾Œé¸æ“‡ä¸€å€‹å»ºç«‹å¥½çš„æ—¥æ›†ï¼Œå¾ è¨­å®šå’Œå…±ç”¨ é€²å…¥æ—¥æ›†çš„è¨­å®šã€‚ æ‰¾åˆ° èˆ‡ç‰¹å®šä½¿ç”¨è€…å…±ç”¨æ—¥æ›† çš„é¸é …ï¼Œé»é¸ æ–°å¢é‚€è«‹å°è±¡ã€‚é€™è£¡çš„ email è¦è¼¸å…¥å‰›æ‰é‚£ä»½é‡‘é‘° JSON æª”ä¸­ï¼Œclient_email_form çš„æ¬„ä½å…§å®¹ï¼Œæ¬Šé™è¦è¨˜å¾—èª¿æ•´æˆ é€²è¡Œè®Šæ›´ä¸¦ç®¡ç†å…±ç”¨è¨­å®šã€‚ æ¥è‘—æŠŠç¶²é å¾€ä¸‹æ‹‰ï¼Œæ‰¾åˆ° æ•´åˆæ—¥æ›† çš„å€å¡Šï¼Œè¨˜ä¸‹é€™å€‹ æ—¥æ›† IDï¼Œæ¥ä¸‹ä¾†æœƒä½¿ç”¨åˆ°ã€‚ åˆ°ç›®å‰ç‚ºæ­¢ï¼Œéœ€è¦ä½¿ç”¨çš„éƒ¨åˆ†éƒ½æº–å‚™å®Œæˆäº†ï¼Œæ¥ä¸‹ä¾†è¦é€²å…¥åˆ°ç¨‹å¼çš„éƒ¨åˆ†ã€‚\næ–°å¢ä¸€å€‹æ´»å‹• æ–°å¢å¥½ä¸€å€‹å°ˆæ¡ˆä¹‹å¾Œï¼Œå¾ Nuget å°‡ Google.Apis.Calendar.v3 æ–°å¢åˆ°å°ˆæ¡ˆå…§ï¼Œä¸¦åŠ å…¥ä¸‹åˆ—ç¨‹å¼ç¢¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 using Google.Apis.Auth.OAuth2; using Google.Apis.Calendar.v3; using Google.Apis.Calendar.v3.Data; using Google.Apis.Services; const string jsonFile = \u0026#34;key.json\u0026#34;; const string calendarId = \u0026#34;id@group.calendar.google.com\u0026#34;; GoogleCredential credential; using var stream = new FileStream(jsonFile, FileMode.Open, FileAccess.Read); credential = GoogleCredential.FromStream(stream).CreateScoped(CalendarService.Scope.Calendar); var service = new CalendarService(new BaseClientService.Initializer { HttpClientInitializer = credential, ApplicationName = \u0026#34;test project\u0026#34;, }); var newEvent = new Event() { Id = Guid.NewGuid().ToString().Replace(\u0026#34;-\u0026#34;, \u0026#34;\u0026#34;), Summary = \u0026#34;Anthea å¤–å‡º(é€¢ç”²å¤§å­¸)\u0026#34;, Start = new EventDateTime() { DateTime = new DateTime(2022, 05, 15, 09, 30, 0), TimeZone = \u0026#34;Asia/Taipei\u0026#34; // Can refer to https://stackoverflow.com/questions/22526635/list-of-acceptable-google-calendar-api-time-zones }, End = new EventDateTime() { DateTime = new DateTime(2022, 05, 15, 10, 30, 0), TimeZone = \u0026#34;Asia/Taipei\u0026#34; } }; var insert = service.Events.Insert(newEvent, calendarId).Execute(); åŸ·è¡Œä¹‹å¾Œå›åˆ°æ—¥æ­·çš„é é¢ï¼Œå°±æœƒçœ‹åˆ°å‰›å‰›æ–°å¢ä¸Šå»çš„æ´»å‹•äº†ï¼\nDebug ç´€éŒ„ Invalid resource id value 1 2 3 4 5 6 Google.Apis.Requests.RequestError Invalid resource id value. [400] Errors [ Message[Invalid resource id value.] Location[ - ] Reason[invalid] Domain[global] ] æ¸¬è©¦çš„éç¨‹ä¸­æœ‰å‡ºç¾é€™å€‹ errorï¼Œçœ‹äº†å®˜æ–¹æ–‡ä»¶ä¹‹å¾Œç™¼ç¾å•é¡Œæ˜¯å‡ºåœ¨ Event ä¸Šï¼Œæ–¼æ˜¯é¸æ“‡å¦ç”¨æ¯”è¼ƒä¸å®¹æ˜“é‡è¤‡çš„ GUID å»ä½œç‚ºåƒæ•¸å¸¶ä¸Šå»ã€‚å¦å¤–ï¼Œæ–‡ä»¶ä¸Šæœ‰æåˆ°åªèƒ½ä½¿ç”¨å°å¯«çš„è‹±æ–‡å­—æ¯å’Œæ•¸å­—ï¼Œè¦è¨˜å¾—æ³¨æ„ã€‚\nå°çµ é™¤äº†ç¯„ä¾‹è£¡æåˆ°çš„ Insert ä¹‹å¤–ï¼ŒåŸºæœ¬çš„ CRUD éƒ½æœ‰ API å¯ä»¥æ¥ï¼Œä½†æˆ‘ç›®å‰çš„ç³»çµ±é‚„æ²’æœ‰é€™éƒ¨åˆ†çš„åŠŸèƒ½è¦å¯¦ä½œï¼Œæ‰€ä»¥æ²’æœ‰ç‰¹åˆ¥ç ”ç©¶ã€‚\nå¦å¤–ï¼Œå®˜æ–¹æ–‡ä»¶æ‰€æä¾›çš„è¨»å†Šæ–¹æ³•ï¼Œä½¿ç”¨çš„æ†‘è­‰é¡åˆ¥å’Œç¯„ä¾‹ä¸­çš„ä¸å¤ªä¸€æ¨£ï¼Œæˆ‘å€‹äººèªç‚ºæ¯”è¼ƒéº»ç…©ï¼Œæ‰€ä»¥é¸æ“‡äº†æœå‹™å¸³æˆ¶çš„æ–¹æ³•ã€‚é›–ç„¶å¤§éƒ¨åˆ†çš„åŠŸèƒ½éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä½†åƒæ˜¯ Event.Attendees é€™å€‹é‚€è«‹åƒèˆ‡è€…çš„éƒ¨åˆ†ï¼Œå°±éœ€è¦å¦å¤–è¨­å®šå¥½æ¬Šé™æ‰å¯ä»¥ä½¿ç”¨ã€‚\nä»¥ä¸Šå°±æ˜¯é€™æ¬¡çš„å…§å®¹ï¼Œå¦‚æœæœ‰ä»»ä½•ä½¿ç”¨ä¸Šçš„ç–‘å•ï¼Œæˆ–æ˜¯è§£é‡‹ä¸Šçš„éŒ¯èª¤ï¼Œéƒ½æ­¡è¿è·Ÿæˆ‘èªªå–”ï¼æˆ‘å€‘ä¸‹æ¬¡è¦‹ã€‚\nåƒè€ƒæ–‡ç« \nTimeZone List Google Calendar Api with .NET At least one client secrets (Installed or Web) should be set ","date":"2022-05-14T21:55:35+08:00","permalink":"https://anthea-wu.github.io/post/google-calendar-api/","title":"Google Calendar API"},{"content":"é ç«¯ä¸»æ©Ÿå·²å¼·åˆ¶é—œé–‰ä¸€å€‹ç¾å­˜çš„é€£ç·š Server A ä¸€ç›´æœ‰ä¸€éš»é‹è¡Œçš„å¾ˆæ­£å¸¸çš„ API æä¾›çµ¦ Server B å’Œ Server C å‘¼å«ï¼Œåœ¨æŸä¸€å¤©å¿½ç„¶ Server B å°±å‘¼å«å¤±æ•—äº†ï¼ŒåŒä¸€æ™‚é–“ Server C ä»¥åŠæˆ‘çš„ local ç’°å¢ƒä»ç„¶å¯ä»¥æ­£å¸¸ä½¿ç”¨é‚£éš» APIã€‚æŸ¥çœ‹ Server B log å¾Œç™¼ç¾é¡¯ç¤ºçš„éŒ¯èª¤æ˜¯ï¼š\n1 2 åŸºç¤é€£æ¥å·²é—œé–‰: å‚³é€æ™‚ç™¼ç”Ÿæœªé æœŸéŒ¯èª¤ï¼Œé ç«¯ä¸»æ©Ÿå·²å¼·åˆ¶é—œé–‰ä¸€å€‹ç¾å­˜çš„é€£ç·šã€‚ The underlying connection was closed: An unexpected error occurred on a send. ç”±æ–¼æ˜¯æ¯”è¼ƒå¤è€çš„æœå‹™äº†ï¼Œæœ€è¿‘ä¸€æ®µæ™‚é–“éƒ½æ²’æœ‰ä¿®æ”¹éå…©é‚Šçš„ç¨‹å¼ç¢¼ï¼Œæ‰€ä»¥å…ˆæ’é™¤äº†æ”¹å£äº†çš„å¯èƒ½æ€§ã€‚æŠŠéŒ¯èª¤è¨Šæ¯æ‹¿å» google å¾Œï¼Œçœ‹åˆ°é€šå¸¸æ˜¯å› ç‚ºçµ‚æ­¢ TLS 1.0ã€1.1 çš„æœå‹™æ‰€å°è‡´ï¼Œåªè¦åŠ ä¸Šé€™æ®µç¨‹å¼ç¢¼å°±å¯ä»¥é‹è¡Œäº†ï¼š\n1 ServicePointManager.SecurityProtocol = SecurityProtocolType.Ssl3 | SecurityProtocolType.Tls | SecurityProtocolType.Tls11 | SecurityProtocolType.Tls12; Client Hello \u0026amp; Server Hello å‰›å¥½æœ€è¿‘é‡æ–°æ‹¾èµ·ç¶²è·¯å”å®šçš„ç›¸é—œæ›¸ç±é–±è®€ä¸­ï¼Œæ›¸è£¡æœ‰ä¸€äº›ä½¿ç”¨ Wireshark çš„ç¯„ä¾‹ï¼ŒæŠ±æŒè‘—å°‡å°±è©¦è©¦çœ‹çš„å¿ƒæ…‹ï¼Œå°±æ‰“é–‹äº† Wireshark ä¾†ç ”ç©¶çœ‹çœ‹åˆ°åº•å¾æˆ‘ local ç«¯ç™¼é€å‡ºå»çš„è«‹æ±‚å’Œ Server B åˆ°åº•æœ‰ç”šéº¼ä¸åŒã€‚\nå¾ä¸Šé¢é€™å¼µæˆªåœ–çš„æ¯”è¼ƒå¯ä»¥çœ‹åˆ°ï¼Œå·¦é‚Š local ç«¯æœ‰å‡ºç¾ Client Hello å’Œ Server Helloï¼Œä½†å³é‚Š Server B å»åªå‡ºç¾äº† Client Helloã€‚ä½†é€™å…©å€‹äº’ç›¸èªªå“ˆå›‰çš„æ±è¥¿æ˜¯ä»€éº¼ï¼Ÿ\nTLS äº¤æ¡ åœ¨ç¶²éš›ç¶²è·¯çš„äº‹ä»¶ä¸­ï¼Œæ‡‰è©²å¾ˆå¤šäººéƒ½è½èªªéä¸‰é …äº¤æ¡ï¼Œå…¨åæ‡‰è©²æ˜¯ TCP ä¸‰é …äº¤æ¡ï¼ˆTCP Three-Way Handshakeï¼‰ï¼Œé€éé€™å€‹éç¨‹å»ºç«‹é€£ç·šã€‚\nä½†æ˜¯é€™å€‹é€£ç·šå»ºç«‹å¾Œæ˜¯æ²’æœ‰åŠ å¯†çš„ç‹€æ…‹ï¼Œå› æ­¤è¦é€é TLS äº¤æ¡ ä¾†ç¢ºä¿é›™æ–¹èƒ½å®‰å…¨åœ°äº¤æ›åŠ å¯†é‡‘é‘°ï¼Œä¸¦ç¢ºå®šåŠ å¯†çš„å”å®šç‰ˆæœ¬å’ŒåŠ å¯†ç®—æ³•ã€‚è©³ç´°çš„æ­¥é©Ÿæ˜¯ï¼š\nå®¢æˆ¶ç«¯ç™¼é€ ClientHello è¨Šæ¯ï¼Œå‘ŠçŸ¥ä¼ºæœå™¨å®¢æˆ¶ç«¯é€™é‚Šæ”¯æ´çš„ TLS ç‰ˆæœ¬ä»¥åŠå¯†ç¢¼å¥—ä»¶ã€‚ ä¼ºæœå™¨å›æ‡‰ ServerHello è¨Šæ¯ï¼Œé¸æ“‡ä½¿ç”¨çš„åŠ å¯†ç®—æ³•å’Œå”å®šç‰ˆæœ¬ï¼Œä¸¦å‚³é€ä¼ºæœå™¨è­‰æ›¸ç­‰è³‡è¨Šä¾†è­‰æ˜èº«ä»½ã€‚ é›™æ–¹äº¤æ›åŠ å¯†é‡‘é‘°å’Œä¸€äº›å®‰å…¨åƒæ•¸ï¼Œå®ŒæˆåŠ å¯†é€šè¨Šçš„æº–å‚™ã€‚ å®¢æˆ¶ç«¯å’Œä¼ºæœå™¨ç¢ºèªæ‰€æœ‰è¨Šæ¯äº¤æ›ç„¡èª¤å¾Œï¼ŒTLS æ¡æ‰‹çµæŸï¼Œé€šä¿¡é–‹å§‹é€²å…¥åŠ å¯†çš„æ•¸æ“šå‚³è¼¸éšæ®µã€‚ ç”±æ–¼ TLS çš„ç›®çš„å°±æ˜¯ç¢ºä¿è³‡æ–™åœ¨å‚³è¼¸éç¨‹ä¸­çš„æ©Ÿå¯†æ€§ã€å®Œæ•´æ€§åŠèº«ä»½é©—è­‰ï¼Œåªè¦æœ‰ä¸€å€‹æ­¥é©Ÿç¼ºå¤±å°±ä»£è¡¨ç„¡æ³•å»ºç«‹å®‰å…¨çš„é€£ç·šï¼Œå› æ­¤é€£ç·šå°±è¢«ä¸­æ–·ã€‚å¾å‰›å‰›çš„æˆªåœ–å¯ä»¥çœ‹åˆ° Server B ç¢ºå¯¦æ²’æœ‰ç­‰åˆ° ServerHello çš„è¨Šæ¯ï¼Œç‚ºäº†ç¢ºå®šæ˜¯ä¸æ˜¯é€™å€‹å•é¡Œï¼Œæˆ‘æ±ºå®šè¦åˆ†åˆ¥çœ‹çœ‹é€™ä¸‰å° Server çš„ TLS ç‰ˆæœ¬ä»¥åŠå¯†ç¢¼å¥—ä»¶æœ‰å“ªäº›ã€‚\næª¢æŸ¥å…è¨±çš„å¯†ç¢¼å¥—ä»¶ï¼šQualys Labs Qualys Labs é€™å€‹ç¶²ç«™ä¸»è¦æ˜¯é‡å° SSL å®‰å…¨æ€§åšçš„æƒæï¼Œæƒæå‡ºçš„å…§å®¹å‰›å¥½åŒ…å«æˆ‘å€‘æ‰€éœ€è¦çš„å¯†ç¢¼å¥—ä»¶æ¸…å–®ã€‚æ“ä½œçš„æ–¹å¼ä¹Ÿå¾ˆç°¡å–®ï¼š\né€éé€™å€‹ç¶²ç«™çš„æ¯”å°ï¼Œæˆ‘ç¢ºå®šäº†é€™æ¬¡ Server B é‡åˆ°çš„å•é¡Œï¼šç”±æ–¼é‚£é™£å­å‰›åšå®Œå¼±é»æƒæï¼ŒServer A è¢«æƒå‡ºäº† Weak SSL Protocol çš„å•é¡Œï¼Œæ‰€ä»¥æˆ‘ä½¿ç”¨ IIS Crypto æŠŠä¸€äº›ä¸å®‰å…¨çš„éæ™‚å”è­°é—œé–‰ï¼Œä½† Server B å¤ªéå¤è€ï¼Œæ²’è¾¦æ³•æ”¯æ´æ–°çš„å”è­°ï¼Œé€™å°±å°è‡´äº†é€™æ¬¡çš„å•é¡Œï¼ŒServer B åªèƒ½ä½¿ç”¨ä¸å®‰å…¨çš„å¯†ç¢¼å¥—ä»¶ï¼Œä½† Server A ä¸å…è¨±ä½¿ç”¨ï¼Œåœ¨æ²’è¾¦æ³•æŒ‘å‡ºå¯ç”¨å¥—ä»¶çš„æƒ…æ³ä¸‹ï¼Œè‡ªç„¶ä¹Ÿå°±æ²’è¾¦æ³•å›è¦† ServerHello çš„è¨Šæ¯ã€‚\nåƒè€ƒè³‡æ–™\nTLS æ¡æ‰‹ä¸­ç™¼ç”Ÿäº†ç”šéº¼äº‹ï¼Ÿ é‚£äº›é—œæ–¼SSL/TLSçš„äºŒä¸‰äº‹ ","date":"2022-05-03T00:00:00Z","permalink":"https://anthea-wu.github.io/post/%E4%B8%8D%E5%B8%B8%E8%A6%8B%E7%9A%84%E9%81%A0%E7%AB%AF%E4%B8%BB%E6%A9%9F%E5%B7%B2%E5%BC%B7%E5%88%B6%E9%97%9C%E9%96%89%E9%80%A3%E7%B7%9A/","title":"ä¸å¸¸è¦‹çš„é ç«¯ä¸»æ©Ÿå·²å¼·åˆ¶é—œé–‰é€£ç·š"}]